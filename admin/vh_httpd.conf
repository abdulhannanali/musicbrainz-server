<VirtualHost *>
    # TODO: This needs to point to where the htdocs are
    DocumentRoot "/home/httpd/musicbrainz/mb_server/htdocs"
    # TODO: This needs to point to where the cgi-bin scripts are
    Alias /cgi-bin/ "/home/httpd/musicbrainz/mb_server/cgi-bin/"

    # TODO: Enter the name of your server.  You should have two names
    # available: one for web browsing (HTML), and one for web services (RDF).
    ServerName www.musicbrainz.example.com
    ServerAlias rdf.musicbrainz.example.com

    DefaultType text/html

    # TODO: This directory needs to be the same as DocumentRoot above
    <Directory /home/httpd/musicbrainz/mb_server/htdocs>
       SetHandler perl-script
       PerlHandler MusicBrainz::Server::Mason
    </Directory>

    <Location /cgi-bin>
       SetHandler  perl-script
       PerlHandler Apache::Registry
       Options +ExecCGI
    </Location>

    PerlModule Apache::DBI
    # TODO: Where to find startup.pl
    PerlRequire /home/httpd/musicbrainz/mb_server/admin/startup.pl
    PerlTransHandler MusicBrainz::Server::Handlers::TransHandler

    RewriteEngine on

    # Rules for the web (HTML) site
    # I'm not sure these ones are used - they can probably be removed soon
    RewriteRule   ^/showartist/(.*)$     /showartist.html?mbid=$1                         [PT]
    RewriteRule   ^/showalbum/(.*)$      /showalbum.html?mbid=$1                          [PT]
    RewriteRule   ^/showtrack/(.*)$      /showtrack.html?mbid=$1                          [PT]
    # These ones are the "permanent URLs" to HTML pages
    RewriteRule   ^/artist/([^/]+)\.html$	/showartist.html?mbid=$1		[PT,QSA]
    RewriteRule   ^/album/([^/]+)\.html$	/showalbum.html?mbid=$1			[PT,QSA]
    RewriteRule   ^/track/([^/]+)\.html$	/showtrack.html?mbid=$1			[PT,QSA]

    RewriteRule   ^/ftpmirror/(.*)$      /products/selectmirror.html?path=$1              [PT]

    # Rules for RDF (mm-2.0)
    RewriteRule   ^/artist/([^/]+)/(.*)  /cgi-bin/rdf.pl?query=artist&id=$1&depth=$2      [PT]
    RewriteRule   ^/artist/(.*)          /cgi-bin/rdf.pl?query=artist&id=$1               [PT]
    RewriteRule   ^/album/([^/]+)/(.*)   /cgi-bin/rdf.pl?query=album&id=$1&depth=$2       [PT]
    RewriteRule   ^/album/(.*)           /cgi-bin/rdf.pl?query=album&id=$1                [PT]
    RewriteRule   ^/track/([^/]+)/(.*)   /cgi-bin/rdf.pl?query=track&id=$1&depth=$2       [PT]
    RewriteRule   ^/track/(.*)           /cgi-bin/rdf.pl?query=track&id=$1                [PT]
    RewriteRule   ^/trmid/([^/]+)/(.*)   /cgi-bin/rdf.pl?query=trmid&id=$1&depth=$2       [PT]
    RewriteRule   ^/trmid/(.*)           /cgi-bin/rdf.pl?query=trmid&id=$1                [PT]
    RewriteRule   ^/trm/([^/]+)/(.*)     /cgi-bin/rdf.pl?query=trmid&id=$1&depth=$2       [PT]
    RewriteRule   ^/trm/(.*)             /cgi-bin/rdf.pl?query=trmid&id=$1                [PT]
    RewriteRule   ^/cdindex/([^/]+)/(.*) /cgi-bin/rdf.pl?query=cdindexid&id=$1&depth=$2   [PT]
    RewriteRule   ^/cdindex/(.*)         /cgi-bin/rdf.pl?query=cdindexid&id=$1            [PT]

    # Rules for RDF (mm-2.1)
    RewriteRule   ^/mm-2.1/artist/([^/]+)/(.*)  /cgi-bin/rdf_2_1.pl?query=artist&id=$1&depth=$2      [PT]
    RewriteRule   ^/mm-2.1/artist/(.*)          /cgi-bin/rdf_2_1.pl?query=artist&id=$1               [PT]
    RewriteRule   ^/mm-2.1/album/([^/]+)/(.*)   /cgi-bin/rdf_2_1.pl?query=album&id=$1&depth=$2       [PT]
    RewriteRule   ^/mm-2.1/album/(.*)           /cgi-bin/rdf_2_1.pl?query=album&id=$1                [PT]
    RewriteRule   ^/mm-2.1/track/([^/]+)/(.*)   /cgi-bin/rdf_2_1.pl?query=track&id=$1&depth=$2       [PT]
    RewriteRule   ^/mm-2.1/track/(.*)           /cgi-bin/rdf_2_1.pl?query=track&id=$1                [PT]
    RewriteRule   ^/mm-2.1/trmid/([^/]+)/(.*)   /cgi-bin/rdf_2_1.pl?query=trmid&id=$1&depth=$2       [PT]
    RewriteRule   ^/mm-2.1/trmid/(.*)           /cgi-bin/rdf_2_1.pl?query=trmid&id=$1                [PT]
    RewriteRule   ^/mm-2.1/trm/([^/]+)/(.*)     /cgi-bin/rdf_2_1.pl?query=trmid&id=$1&depth=$2       [PT]
    RewriteRule   ^/mm-2.1/trm/(.*)             /cgi-bin/rdf_2_1.pl?query=trmid&id=$1                [PT]
    RewriteRule   ^/mm-2.1/cdindex/([^/]+)/(.*) /cgi-bin/rdf_2_1.pl?query=cdindexid&id=$1&depth=$2   [PT]
    RewriteRule   ^/mm-2.1/cdindex/(.*)         /cgi-bin/rdf_2_1.pl?query=cdindexid&id=$1            [PT]
</VirtualHost>  

%# vi: set ts=2 sw=2 ft=mason :
<%args>
$artistid => undef
</%args>
<%perl>

$m->comp("/comp/sidebar", title => "Add Album");

unless ($artistid)
{
	</%perl>

	<table width="100%">
		<tr>
			<td align="center">

				<p>
					To add an album, please go to that artist's main page,
					and click on the <b>Add Album</b> link.
				</p>

				<& /comp/tablebegin, title=>"Artist Search" &>
				<& /comp/textsearch &>
				<& /comp/tableend &>

			</td>
		</tr>
	</table>

	<& /comp/movefocus, "TextSearchForm", "search" &>
	<& /comp/footer &>

	<%perl>
	return;
}

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

MusicBrainz::IsNonNegInteger($artistid) && $artistid
	or return $m->comp("/comp/badargs", 0, 1);

$artistid != &ModDefs::DARTIST_ID
	or return $m->comp(
		"/comp/error",
		"You cannot add an alias to this artist.",
		0, 1,
	);

my $mb = $m->comp("/comp/dblogin");

my $ar = Artist->new($mb->{DBH});
$ar->SetId($artistid);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist #$artistid does not exist",
		0, 1,
	);

</%perl>

<& /comp/stylemenu &>

<h2>Add Album</h2>

<p>
	You are about to add an album to the artist
	<b><% $ar->GetName %></b>.
</p>

<p>
	Please read the style notes (see links above)
	and enter the number of tracks on this album:
</p>

		<form method="post" name="AddAlbumForm"
%   if ($artistid == &ModDefs::VARTIST_ID) {
			action="/cdi/menter.html"
%   } else {
			action="/cdi/enter.html"
%   }
			enctype="application/x-www-form-urlencoded">

    <table>
      <tr>
        <td align="right">
					Number of tracks on this album:
        </td>
        <td>
					<input type="text" name="tracks" size="3" value=""> (1 - 99)
        </td>
      </tr>
      <tr>
        <td colspan=2>
					<input type="submit" value="Next &gt;&gt;">
        </td>
      </tr>
		</table>

    <input type="hidden" name="noncd" value="1">
    <input type="hidden" name="id" value="">
    <input type="hidden" name="toc" value="">
    <input type="hidden" name="artist" value="<% $artistid %>">
	</form>

<& /comp/movefocus, "AddAlbumForm", "tracks" &>
<& /comp/footer &>

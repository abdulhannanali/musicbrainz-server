%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => undef
$nontrack => 0
</%args>

<& /comp/sidebar, title => 'Add Track' &>

<%perl>

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

MusicBrainz::IsNonNegInteger($album) && $album
	or return $m->comp("/comp/badargs", 0, 1);

MusicBrainz::IsNonNegInteger($nontrack) && $nontrack < 100
	or return $m->comp("/comp/badargs", 0, 1);

my $mb = $m->comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
$al->SetId($album);
$al->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Album #$album does not exist",
		0, 1,
	);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($al->GetArtist);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist does not exist",
		0, 1,
	);

my $name = ($nontrack) ? $ar->GetName() . " Non-album tracks" : $al->GetName();

</%perl>

<& /comp/stylemenu &>

<& /comp/tablebegin, gattrs => "width='100%'",
	title => "Add Track to '$name'" &>

	<form method="post"
% if ($ar->GetId == ModDefs::VARTIST_ID) {
		action="/artistfilterkv.html"
% } else {
		action="/bare/enter_kv_mod.html"
% }
		enctype="application/x-www-form-urlencoded"
		name="AddTrackForm"
		>

    <table>
      <tr>
        <td>
					Track Name:
        </td>
        <td>
					<input type="text" name="value1" size="25">
        </td>
      </tr>

% if (!$nontrack) {
      <tr>
        <td>
					Track Number:
        </td>
        <td>
					<input type="text" name="value2" size="25"> (1 - 99)
        </td>
      </tr>
% } else {
      <tr>
        <td colspan="2">
           <input type="hidden" name="value2" value="<% $nontrack %>">
        </td>
      </tr>
% }

% if ($ar->GetId == ModDefs::VARTIST_ID) {
      <tr>
        <td>
					Artist Sortname:
        </td>
        <td>
					<input type="text" name="value4" size="25">
					<input type="hidden" name="key4" value="SortName">
					<input type="hidden" name="value3" value="">
					<input type="hidden" name="key3" value="ArtistName">
        </td>
      </tr>
% }

      <tr>
        <td colspan=2>
					<input type="submit" value="Submit">
        </td>
      </tr>
    </table>

    <input type="hidden" name="value0" value="<% $al->GetId() %>">
    <input type="hidden" name="key0" value="AlbumId">
    <input type="hidden" name="key1" value="TrackName">
    <input type="hidden" name="key2" value="TrackNum">
		<input type="hidden" name="artist" value="<% $ar->GetId %>">
    <input type="hidden" name="type" value="<% ModDefs::MOD_ADD_TRACK_KV %>">
    <input type="hidden" name="prev" value="<% $al->GetName() %>">
    <input type="hidden" name="table" value="Track">
    <input type="hidden" name="id" value="<% $al->GetId() %>">
    <input type="hidden" name="column" value="Name">
    <input type="hidden" name="url" value="/showalbum.html?albumid=<% $al->GetId() %>">
% if ($ar->GetId == ModDefs::VARTIST_ID) {
    <input type="hidden" name="title" value="Select Artist for Track Addition">
    <input type="hidden" name="mode" value="addtrack">
% }

	</form>

<& /comp/tableend &>

% $mb->Logout;

<& /comp/movefocus, "AddTrackForm", "value1" &>
<& /comp/footer &>

<& /comp/sidebar, title=>'Add Track', expand=>'moderation' &>

<%perl>

my ($mb, $id, $trackname, $al, $tracknum, $album, $artist); 

$mb = new MusicBrainz;
$mb->Login();
$al = Album->new($mb->{DBH});

if (!exists $ARGS{album} || $ARGS{album} eq '' ||
    !exists $ARGS{artist} || $ARGS{artist} eq '')
{
    mc_comp("/comp/badargs");
    return undef;
}

$album = $ARGS{album};
$artist = $ARGS{artist};
$al->SetId($album);
$al->LoadFromId();

</%perl>

% if (!defined $session{user} || $session{user} eq '') {
    You must be logged in to edit the database.<p>
    <& /comp/tablebegin, title=>'Login' &>
    <& /comp/loginbox &>
    <& /comp/tableend &>
% } else {

    <& /comp/tablebegin, gattrs=>"width=\"100%\"",
       title=>'Add Track to '.$al->GetName() &>

% if ($artist == Artist::VARTIST_ID) {
    <FORM METHOD="POST" ACTION="/artistfilterkv.html"
% } else {
    <FORM METHOD="POST" ACTION="/bare/enter_kv_mod.html"
% }
          ENCTYPE="application/x-www-form-urlencoded" NAME="AddTrackForm">  
    <table>
      <tr>
        <td>
        Track Name:
        </td>
        <td>
        <INPUT TYPE="text" NAME="value1" SIZE=25> 
        </td>
      </tr>
      <tr>
        <td>
        Track Number:
        </td>
        <td>
        <INPUT TYPE="text" NAME="value2" SIZE=25> (1 - 99)
        </td>
      </tr>
% if ($artist == Artist::VARTIST_ID) {
      <tr>
        <td>
        Artist Sortname:
        </td>
        <td>
        <INPUT TYPE="text" NAME="value4" SIZE=25> 
        <input type="hidden" name="key4" value="SortName">
        <input type="hidden" name="value3" value="">
        <input type="hidden" name="key3" value="ArtistName">
        </td>
      </tr>
% }
      <tr>
        <td colspan=2>
        <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
        </td>
      </tr>
    </table>


    <input type="hidden" name="value0" value="<% $al->GetId() %>">
    <input type="hidden" name="key0" value="AlbumId">
    <input type="hidden" name="key1" value="TrackName">
    <input type="hidden" name="key2" value="TrackNum">

    <input type="hidden" name="artist" value="<% $artist %>">
    <input type="hidden" name="type"
           value="<% ModDefs::MOD_ADD_TRACK_KV %>">
    <input type="hidden" name="prev" value="<% $al->GetName() %>">
    <input type="hidden" name="table" value="Track">
    <input type="hidden" name="id" value="<% $al->GetId() %>">
    <input type="hidden" name="column" value="Name">
    <input type="hidden"
           name="url" value="/showalbum.html?albumid=<% $al->GetId() %>">
% if ($artist == Artist::VARTIST_ID) {
    <input type="hidden" name="title" value="Select Artist for Track Addition">
    <input type="hidden" name="mode" value="addtrack">
% }
    </form>
      
    <& /comp/tableend &>

    <& /comp/stylenotes &>
% }
% $mb->Logout();

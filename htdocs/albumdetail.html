%# vi: set ts=4 sw=4 ft=mason :
<%args>
$albumid => ""
$mbid => ""
</%args>
<%perl>

if ($mbid ne "")
{
	MusicBrainz::IsGUID($mbid)
		or return $m->comp("/comp/badargs", 1, 1);
} else {
	MusicBrainz::IsNonNegInteger($albumid) && $albumid
		or return $m->comp("/comp/badargs", 1, 1);
}

my $mb = $m->comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
if ($mbid ne "")
{
	$al->SetMBId($mbid);
} else {
	$al->SetId($albumid);
}
$al->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Album #$albumid not found",
		1, 1,
	);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($al->GetArtist);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist not found",
		1, 1,
	);

</%perl>

<& /comp/sidebar, title => "Album Details: " . $al->GetName &>

<& /comp/albuminfo, album => $al &>
<& /comp/artistinfo, artist => $ar &>

<& /comp/footer &>

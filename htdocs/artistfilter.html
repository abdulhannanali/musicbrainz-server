<%perl>

my ($mb, $i, $j, $mod, $new, @names, $ar);
my ($sortname, $name, $key, $found);

mc_comp("/comp/sidebar", title=>'Select Artist');

$mb = new MusicBrainz;
$mb->Login();

$ar = Artist->new($mb);
@names = $ar->FindArtist($ARGS{new0});

$found = 0;
foreach $key (@names)
{
    if (lc($key) eq lc($ARGS{new0}))
    {
       $found = 1;
       last;
    }
}
</%perl>

A search on <font class="bold"><% $ARGS{new0} %></font>
has turned up the following matching artists that are similar to the 
artist name that you just entered. 

% if ($ARGS{mode} eq 'move') {
Please choose one of the artists below, and click Finish>> to
move album <span class="bold"><% $ARGS{prev0} %></span> to the selected artist:
% } elsif ($ARGS{mode} eq 'merge') {
Please choose one of the artists below, and click Finish>> to
merge artist <span class="bold"><% $ARGS{prev0} %></span> with the selected artist:
% } else {
Please choose one of the artists below, and click Finish>> to
move track <span class="bold"><% $ARGS{prev0} %></span> to the selected artist:
% }

<form method="POST" action="/bare/enter_mod.html"
      enctype="application/x-www-form-urlencoded" class="formstyle">


% if (!$found) {
<& /comp/tablebegin, title=>'New Artist', gattrs=>'width="100%"' &>
<input type="radio" name="new0" 
       value="<% $ARGS{new0} %>" CHECKED>&nbsp;<% $ARGS{new0} %><p>
<& /comp/tableend, title=>'Existing Artists' &>
% }

% if (scalar(@names) > 0) {

    <& /comp/tablebegin, title=>'Existing Artists', gattrs=>'width="100%"' &>
    <table> <tr>
    <th>Artist Sortname</th>
    <th>Artist Name</th>
    </tr>

<%perl>
    for($i = 0;; $i++)
    {
        $name = shift @names;
        last if not defined $name;
        $sortname = shift @names;
        last if not defined $sortname;
        mc_out("<tr><td>");
        mc_out(qq\<input type="radio" name="new0" 
               value="$name"\);
        mc_out(" CHECKED") if ($i == 0 && $found);
        mc_out(">&nbsp;$sortname</td><td>$name</td></tr>");
    }
    mc_out("</table>");
    mc_comp("/comp/tableend", title=>'Existing Artists');
}

foreach $key (keys %ARGS)
{
    next if ($key eq 'new0');

    mc_out(qq\<input type="hidden" name="$key" value="$ARGS{$key}">\);
    mc_out("\n");
}

</%perl>
<input type="submit" value="Finish>>" name="Search">
</form>
<%perl>

$mb->Logout();

</%perl>

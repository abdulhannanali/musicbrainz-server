%# vi: set ts=4 sw=4 ft=mason :
<%args>
	$artistid=>0
</%args>
<%perl>


	if (!exists $ARGS{artistid} || $ARGS{artistid} eq '')
	{
		$m->comp("/comp/badargs");
		return undef;
	}

	my $mb = $m->comp("/comp/dblogin");
	my $artist = Artist->new($mb->{DBH});
	$artist->SetId($artistid);
	if (! $artist->LoadFromId())
	{
		$m->comp("/comp/sidebar", title=>"Error");
		$m->out("This artist (id=$artistid) was not found in the database.");
	}
	else
	{
		$m->comp("/comp/sidebar", title=>("Related Artists: " . $artist->GetName));
		$m->comp("/comp/artisttitle", artist=>$artist);
		$m->comp("/comp/tablebegin", title=>"Related Artists");

		my $relations = $artist->GetRelations();
		if (@$relations)
		{

</%perl>

		<table cellspacing="0" cellpadding="0" class="listing">
			<tr class="header">
				<td class="left">Artist</td>
				<td>Strength</td>
				<td>Albums</td>
			</tr>


<%perl>
			for my $rel (@{$relations})
			{
				my $weight = $rel->{weight};
				my $id = $rel->{id};
				my $name = $rel->{name};

				# calculate index in weight bg colors table.
				my $bgweight = $weight-1;
				$bgweight = 9 if ($bgweight > 9);
				$bgweight = 0 if ($bgweight < 0);
</%perl>
			<tr class="artistrel<% $bgweight %>">
				<td class="left">
					<a href="/artistrel.html?artistid=<% $id %>"><% $name %></a></td>
				<td>
					<% $weight %></td>
				<td>
					<a href="/showartist.html?artistid=<% $id %>">
						<img src="/images/cd.png" alt="albums" title="View albums for <% $name %>" />
					</a></td>
			</tr>
			<tr class="spacer">
				<td colspan="3"><img src="/images/spacer.gif" height="1" alt="" /></td></tr>

%			}
		</table>

<%perl>
		}
		else
		{
			$m->out(qq!Sorry, no relationship data available for this artist.!);
		}

		# data source notice.
		$m->out(qq!<div style="margin: 0px; margin-top: 10px; font-size: 11px">This data has been provided by <a href="http://agentarts.com/">Agent Arts</a></div>!);
		$m->comp("/comp/tableend");
	}
	$mb->Logout();
</%perl>

<& /comp/footer &>

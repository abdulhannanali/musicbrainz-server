%# vi: set ts=4 sw=4 ft=mason :
<%args>
$artistid=>0
</%args>
<%perl>

my @colors = ( "#FFFFFF", "#FFFdFC", "#FFFaE4", "#FFF6DE", "#FFF2D7", 
               "#FFEfD1", "#FFEbCa", "#FFE8C4", "#FFE4BE", "#FFE1B7"); 

if (!exists $ARGS{artistid} || $ARGS{artistid} eq '')
{
    $m->comp("/comp/badargs");
    return undef;
}

my $mb = $m->comp("/comp/dblogin");
my $artist = Artist->new($mb->{DBH});
$artist->SetId($artistid);

if (! $artist->LoadFromId())
{
    $m->comp("/comp/sidebar", title=>"Error");
    $m->out("This artist (id=$artistid) was not found in the database.");
}
else
{
    $m->comp("/comp/sidebar", title=>($artist->GetName . " Related Artists"));

    $m->out("[ <a href=\"/showartist.html?artistid=");
    $m->out($artist->GetId());
    $m->out("\">View albums</a>");
    $m->out(" ]<p>");

    </%perl>
    <p>This data has been provided by <a href="http://agentarts.com">Agent Arts</a>.</p>
    <%perl>

    my $relations = $artist->GetRelations();
	if (@$relations)
	{
		$m->comp("/comp/tablebegin", title=>"Related Artists");
		</%perl>
		
		<table cellspacing="0">
			<tr>
				<td align="center">Artist</td>
				<td align="center">Strength&nbsp;&nbsp;&nbsp;</td>
				<td align="center">Albums</td>
			</tr>

%		for my $rel (@{$relations}) {

			<tr bgcolor="<% $colors[$rel->{weight} - 1] %>">
				<td><a href="/artistrel.html?artistid=<% $rel->{id} %>"
					><% $rel->{name} %></a>
					&nbsp;&nbsp;
				</td>
				<td align="center" nowrap><% $rel->{weight} %></td>
				<td align="center"
					><a href="/showartist.html?artistid=<% $rel->{id} %>"
						><img src="/images/cd.png"
							alt="albums"
							title="View albums for <% $rel->{name} %>"
						></a></td>
			</tr>
			<tr height="1"><td colspan="3" bgcolor="white"></td></tr>
%		}

		</table>

		<%perl>
		$m->comp("/comp/tableend"); 

	} else {
		</%perl>
		<p>
			Sorry, no relationship data available for this artist.
		</p>
		<%perl>
	}
}

$mb->Logout();

</%perl>
<& /comp/footer &>

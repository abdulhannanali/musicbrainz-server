<%perl>

my ($mb, $i, $mod);

$mb = new MusicBrainz;
$mb->Login();
$mod = Moderation->new($mb);

for($i = 0;; $i++)
{
    last if (!defined($ARGS{('column' . $i)}));
    last if (!defined($ARGS{('new' . $i)}));
    last if (!defined($ARGS{('prev' . $i)}));
    next if ($ARGS{('new' . $i)} eq '');
    next if ($ARGS{('new' . $i)} eq $ARGS{('prev' . $i)});

    $mod->InsertModification($ARGS{table}, 
                             $ARGS{('column' . $i)}, 
                             $ARGS{id},
                             $ARGS{('prev' . $i)}, 
                             $ARGS{('new' . $i)}, 
                             $session{uid});
}
$mb->Logout();

$r->method('GET');
$r->headers_in->unset('Content-length');

$r->content_type('text/html');
$r->header_out(Location=>$ARGS{referer});
$r->status(302);

</%perl>

<%args>
$modid=>0
$confirm=>0
$url=>"/moderate.html?type=3"
</%args>

<%perl>

my $mb = mc_comp("/comp/dblogin");

if ($modid > 0 && $confirm eq 'yes')
{
    my $mod = Moderation->new($mb->{DBH});
    my $sql = Sql->new($mb->{DBH});

    $mod = $mod->CreateFromId($modid);
    if (defined $mod)
    {
        eval
        {
            $sql->Begin;
            $mod->RemoveModeration();
            $sql->Commit;
        };
        if ($@)
        {
            my $err = $@;
            $sql->Rollback;

            mc_comp("/comp/sidebar", expand=>"moderation", 
                                    title=>'Remove Moderation Error');
            mc_out("<b>A database error occurred.</b><pre>($err)</pre>");
            mc_comp("/comp/footer");
            return undef;
        }
    }
}

$mb->Logout();

$r->method('GET');
$r->headers_in->unset('Content-length');

$r->content_type('text/html; charset=UTF-8');

$r->header_out(Location=>$url);
$r->status(302);

</%perl>

<%perl>

my ($mb, $mod, $key, @yeslist, @nolist, @abslist);
my $referer = $r->headers_in->{'Referer'};

foreach $key (keys %ARGS)
{
    if ($key =~ /^rowid(\d*)$/)
    {
       push @yeslist, $1 if ($ARGS{$key} eq 'yes');
       push @nolist, $1 if ($ARGS{$key} eq 'no');
       push @abslist, $1 if ($ARGS{$key} eq 'abs');
    }
}

$mb = new MusicBrainz;
$mb->Login();
$mod = Moderation->new($mb);
$mod->InsertVotes($session{uid}, \@yeslist, \@nolist, \@abslist);
$mb->Logout();

$r->method('GET');
$r->headers_in->unset('Content-length');

$r->content_type('text/html');
$r->header_out(Location=>$referer);
$r->status(302);

</%perl>

<%perl>

my ($mb, @info, $row, $ind, $i, $offset, $ar, $rows, $num_artists);
my $max_items = 50;

mc_comp("/comp/sidebar", title=>'Browse Artists');

mc_out("<p>[ <a href=\"/addartist.html\">Add New Artist</a> ]<p>");

$ind = $ARGS{index};
if (!defined $ind || $ind eq '')
{
    mc_out(qq/Pick a letter to start browsing:<p>/);
}
$offset = $ARGS{offset};
$offset = 0 if not defined $offset;
$offset = 0 if $offset < 0;


mc_comp("/comp/framedboxbegin", width=>"100%");
mc_comp("/comp/browsebox", ind=>$ind);
mc_comp("/comp/framedboxend");
mc_out("<p>");

if (!defined $ind || $ind eq '')
{
    exit(0);
}

$mb = mc_comp("/comp/dblogin");
$ar = Artist->new($mb->{DBH});

@info = $ar->GetArtistDisplayList($ind, $offset);
$num_artists = scalar(@info);

mc_comp("/comp/framedboxbegin", width=>"100%");

if ($num_artists > 0)
{
    mc_out('<table width="100%"><tr>');
    mc_comp("/comp/listprevbutton", offset=>$offset, ind=>$ind, 
            text=>"< Prev", num=>$max_items);
    mc_comp("/comp/listprevbutton", offset=>$offset, ind=>$ind, 
            text=>"<< Prev", num=>($max_items * 2));
    mc_out("<td width=\"40%\">&nbsp;</td>");
    mc_comp("/comp/listnextbutton", offset=>$offset, ind=>$ind, 
            text=>"Next >>", num=>($max_items * 2), rows=>$num_artists);
    mc_comp("/comp/listnextbutton", offset=>$offset, ind=>$ind, 
            text=>"Next >", num=>$max_items, rows=>$num_artists);
    mc_out('</tr></table>');

    </%perl>

    <& /comp/modnotice &>

%   $rows = $max_items / 2;
    <p><table align="center" width="100%" bgcolor="#f0efff">
%   for($i = 0; $i < $rows; $i++) {
%      $row = $info[$i];  
%      last if (!defined $row);
       <tr>
          <td width="1%" valign="top">
             <% ($i + 1 + $offset) %>.
          </td>
%           if ($$row[2]) {
                <td valign=top width="50%" bgcolor="#FFFFCC">
%           } else {
                <td valign=top width="50%">
%           }
            <a href="/showartist.html?artistid=<% $$row[0] %>"><% $$row[1] %></a>
          </td>
          <td width="1%" valign="top">
%         $row = $info[$i + $rows];  
%         if (defined $row) {
             <% ($i + 1 + $rows + $offset) %>.
             </td>
%            if ($$row[2]) {
                <td valign=top width="50%" bgcolor="#FFFFCC">
%            } else {
                <td valign=top width="50%">
%            }
             <a href="/showartist.html?artistid=<% $$row[0] %>"><% $$row[1]  %></a>
%         } else {
             &nbsp;</td><td>&nbsp;
%         }
          </td>
      </tr>
%    }
    </table>
%} else {
%   $ind =~ s/_/(wildcard)/g;
%   $ind =~ s/ /(space)/g;
    <p><table align="center" width="100%" bgcolor="#f0efff">
        <tr><td align="center">
        No artists start with the letters <b><% $ind %></b>.
        </td></tr>
        </table>

%  }
<& /comp/framedboxend &>

% $mb->Logout;
<& /comp/footer &>

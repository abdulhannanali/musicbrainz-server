%# vi: set ts=2 sw=2 ft=mason :
<%perl>

my ($mb, @info, $row, $ind, $i, $offset, $page, $ar, $rows, $num_artists);
my $max_items = 50;

$m->comp("/comp/sidebar", title=>'Browse Artists');

$m->out("<p>[ <a href=\"/addartist.html\">Add New Artist</a> ]<p>");

$ind = $ARGS{index};
if (!defined $ind || $ind eq '')
{
    $m->out(qq/Pick a letter to start browsing:<p>/);
}
$offset = $ARGS{offset};
$page = $ARGS{page};
$offset = ($page-1) * $max_items if not defined $offset and defined $page;
$offset = 0 if not defined $offset;
$offset = 0 if $offset < 0;

$m->comp("/comp/framedboxbegin", width=>"100%");
$m->comp("/comp/browsebox", ind=>$ind);
$m->comp("/comp/framedboxend");
$m->out("<p>");

if (!defined $ind || $ind eq '')
{
    exit(0);
}

$mb = $m->comp("/comp/dblogin");
$ar = Artist->new($mb->{DBH});

($num_artists, @info) = $ar->GetArtistDisplayList($ind, $offset);

$m->comp("/comp/framedboxbegin", width=>"100%");

if ($num_artists > 0)
{
    </%perl>
    <& /comp/pageselector, numitems=>$num_artists, 
                           numlinks=>6,
                           snaptoend=>2,
                           pagesize=>$max_items,
                           offset=>$offset,
													 url=>"/browseartists.html",
													 args=>{ index=>$ind },
													 &>
    <& /comp/modnotice &>

%   $rows = $max_items / 2;
    <p><table align="center" width="100%" bgcolor="#f0efff">
%   for($i = 0; $i < $rows; $i++) {
%      $row = $info[$i];  
%      last if (!defined $row);
       <tr>
          <td width="1%" valign="top">
             <% ($i + 1 + $offset) %>.
          </td>
%           if ($$row[2]) {
                <td valign=top width="50%" bgcolor="#FFFFCC">
%           } else {
                <td valign=top width="50%">
%           }
            <a href="/showartist.html?artistid=<% $$row[0] %>"><% $$row[1] %></a>
          </td>
          <td width="1%" valign="top">
%         $row = $info[$i + $rows];  
%         if (defined $row) {
             <% ($i + 1 + $rows + $offset) %>.
             </td>
%            if ($$row[2]) {
                <td valign=top width="50%" bgcolor="#FFFFCC">
%            } else {
                <td valign=top width="50%">
%            }
             <a href="/showartist.html?artistid=<% $$row[0] %>"><% $$row[1]  %></a>
%         } else {
             &nbsp;</td><td>&nbsp;
%         }
          </td>
      </tr>
%    }
    </table>
    <& /comp/pageselector, numitems=>$num_artists, 
                           numlinks=>6,
                           snaptoend=>2,
                           pagesize=>$max_items,
                           offset=>$offset,
													 url=>"/browseartists.html",
													 args=>{ index=>$ind },
													 &>
%} else {
%   $ind =~ s/_/?/g;
%   $ind =~ s/ /_/g;
    <p><table align="center" width="100%" bgcolor="#f0efff">
        <tr><td align="center">
        No artists
				<% length($ind) ? "start with <b>$ind</b>" : "" |n %>
        </td></tr>
        </table>

%  }
<& /comp/framedboxend &>

% $mb->Logout;
<& /comp/footer &>

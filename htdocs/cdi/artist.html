%# vi: set ts=4 sw=4 ft=mason :
<%args>
$id
$toc
$tracks
$search
</%args>
<%perl>

$m->comp("/comp/sidebar", title=>'Submit CD: Artist Search Results');

if ($search eq '')
{
	$m->out("Please enter an artist name into the search field. " .
           "Click on the Back button in your browser and try again.");
}
else
{
	my $mb = $m->comp("/comp/dblogin");
    my $ar = Artist->new($mb->{DBH});

    my $eng = SearchEngine->new($mb->{DBH}, "artist");

	$eng->Search(
		query => $search,
		limit => 0,
	);

    if ($eng->Rows > 0)
    {
        my ($artistid, $artistname, $artistsortname);
</%perl>
        Click on the artist name to display all the albums by that artist:<p>

        <form method="POST" action="/cdi/album.html"
              enctype="application/x-www-form-urlencoded" class="formstyle">

%       while (my $row = $eng->NextRow)
%       {
            <input type="radio" name="artist" value="<% $row->{'artistid'} %>">
				<& /comp/linkartist,
					id			=> $row->{'artistid'},
					name		=> $row->{'artistname'},
					resolution	=> $row->{'artistresolution'},
				&>
				<br>
%       }

        <input type="hidden" name="id" value="<% $id %>">
        <input type="hidden" name="toc" value="<% $toc %>">
        <input type="hidden" name="tracks" value="<% $tracks %>">
        <input type="submit" value="Select Artist &gt;&gt;">
        </form>

        <p>If the artist is not listed above
        you may either try the search again,
        or click on 'New Artist' to enter the information for this
        CD. Please make sure to search carefully before you go
        through the effort to add a new CD.
%   } else {
        There were no artists found given the keywords
        <b>'<% $search %>'</b>. You may either try again,
        or click on 'New Artist' to enter the information for this
        CD. Please make sure to search carefully before you go
        through the effort to add a new CD.
%   }

    <form method="POST" action="/cdi/enter.html"
          enctype="application/x-www-form-urlencoded" class="formstyle">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="toc" value="<% $toc %>">
    <input type="hidden" name="tracks" value="<% $tracks %>">
    <input type="submit" value="New Artist &gt;&gt;">
    </form>

    <hr><b>Start another artist search:</b><p>

    <form method="POST" action="/cdi/artist.html"
          enctype="application/x-www-form-urlencoded" class="formstyle">

    Artist Name:<br>
    <input type="text" name="search" size="30">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="toc" value="<% $toc %>">
    <input type="hidden" name="tracks" value="<% $tracks %>">
    <input type="submit" value="Search">
    </form>

% }

<& /comp/footer &>

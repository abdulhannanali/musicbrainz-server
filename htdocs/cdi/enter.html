<%args>
$tracks
$id
$toc
$artist=>0
$freedb=>0
</%args>
<%perl>

my ($mb); 
my ($i, $artistname, $modpending, $ar);
my ($dbh, $sth, $rv);

mc_comp("/comp/sidebar", title=>'Enter CD Information');

if ($artist > 0)
{
   $mb = mc_comp("/comp/dblogin");
   $ar = Artist->new($mb->{DBH});
   $ar->SetId($artist);
   $ar->LoadFromId();
   $artistname = $ar->GetName();
   if (!defined $artistname)
   {
       $artistname = 'Tabasco bondage action';
   } 
   $mb->Logout;
}

mc_comp("/comp/stylemenu");

my $lookup;
if ($freedb)
{
   my $fdb = FreeDB->new($mb->{DBH});
   $lookup = $fdb->Lookup($id, $toc);
   if (!$lookup)
   {
       $lookup = undef;
   }
}

</%perl>

<& /comp/cdi/entervalidate &>

% if (defined $lookup) {
     Found CD <font class="bold"><% $lookup->{album} %></font> 
     by <font class="bold"><% $lookup->{artist} %></font> at
     <a href="http://www.freedb.org">FreeDB.org</a>.<p>
     Please check the information below for accuracy and correct any
     mistakes you may find:<p>

% } else {
%    if ($freedb) {
         This CD was not found at FreeDB.<p>
%    } else {
         Please enter the CD information below, or 
         click on FreeDB lookup to attempt to load the data for
         this CD from FreeDB:<p>
%        if (!$freedb) {
           <form method="POST" action="/cdi/enter.html" Name="FreeDBLookup"
                 enctype="application/x-www-form-urlencoded" class="formstyle">
           <input type="hidden" name="id" value="<% $id %>">
           <input type="hidden" name="toc" value="<% $toc %>">
           <input type="hidden" name="tracks" value="<% $tracks %>">
           <input type="hidden" name="freedb" value="1">
%        if ($artist > 0) {
           <input type="hidden" name="artist" value="<% $artist %>">
%        }
           <input type="submit" value="FreeDB Lookup" name="Next">
           </form>
%        }

%    }
% }

<form method="POST" action="/cdi/selectattr.html" Name="EnterCD"
      enctype="application/x-www-form-urlencoded" class="formstyle"
      onsubmit="return validate(this);">
<table>
    <tr><td>Artist:</td><td>
% if ($artist <= 0) {
%    if (!defined $lookup) {
        <input type="text" name="artistname" size="50" maxlength="255"></td>
%    } else {
        <input type="text" name="artistname" size="50" maxlength="255"
                value="<% $lookup->{artist} %>"></td>
%    }

    </tr>
    <tr><td>SortName:</td><td>
%    if (!defined $lookup) {
         <input type="text" name="sortname" size="50" maxlength="255">
%    } else {
%        my ($sortname, $st);
%        $st = Style->new;
%        $sortname = $st->MakeDefaultSortname($lookup->{artist});
         <input type="text" name="sortname" size="50" maxlength="255"
                value="<% $sortname %>"></td>
%    }
% } else {
    <span class="bold"><% $artistname %></span>
    <input type="hidden" name="artist" value="<% $artist %>">
% }
</td></tr>

<tr><td>CD Title:</td><td>
% if (!defined $lookup) {
    <input type="text" name="title" size="50" maxlength="255">
% } else {
    <input type="text" name="title" size="50" maxlength="255"
           value="<% $lookup->{album} %>">
% }
</td></tr>

% for($i = 0; $i < $tracks; $i++) {
    <tr><td>Track <% $i + 1 %>:</td><td>

%     if (!defined $lookup) {
         <input type="text" name="track<% $i %>" size="50" maxlength="255">
%     } else {
%        my $ar = $lookup->{tracks};
         <input type="text" name="track<% $i %>" size="50" maxlength="255"
           value="<% $$ar[$i]->{track} %>">
%     }
    
    </td></tr>
% }
</table>

<input type="hidden" name="id" value="<% $id %>">
<input type="hidden" name="toc" value="<% $toc %>">
<input type="hidden" name="tracks" value="<% $tracks %>">
<input type="submit" value="Next>>" name="Next">
</form>

<%args>
$artist
$album
$numtracks
$showids=>1
$nomod
</%args>

<%perl>

my (@ids, $di, $id, $rows, $id_numtracks);

if ($showids)
{
   $di = Diskid->new($album->{DBH});
   @ids = $di->GetDiskIdFromAlbum($album->GetId());
}

if (scalar(@ids) > 0) 
{
    $rows = 0;
    foreach $id (@ids)
    {
       mc_out("<tr>");
       if ($album->GetArtist() == Artist::VARTIST_ID) 
       {
          mc_out('<td colspan="3" ');
       }
       else
       {
          mc_out('<td colspan="2" ');
       }
       if ($id->{toc} =~ /^\d* (\d*)/)
       {
          $id_numtracks = $1;
       }
       else
       {
          $id_numtracks = undef;
       }

       mc_out('align="center" ');
       mc_out($id->{modpending} ? ' bgcolor="#FFFFCC"' : '');
       mc_out('>');
       mc_out("CD Index Id: ");

       if (defined $id_numtracks && $id_numtracks != $numtracks)
       {
           mc_out('<font color="red">');
       }
       mc_out($id->{diskid});
       if (defined $id_numtracks && $id_numtracks != $numtracks)
       {
           mc_out("</font><br>This id belongs to an album that " .
                  "has $id_numtracks tracks.");
       }

       mc_out("<br></td><td align=\"center\">");
       if (exists $session{user} && !$nomod) 
       {
           mc_out("<a href=\"/movediskid.html?diskid=$id->{diskid}&albumid=");
           mc_out($album->GetId() . "&artistid=");
           mc_out($artist->GetId() . "\">Move</a> | ");
           mc_out("<a href=\"/remdiskid.html?diskid=$id->{diskid}&albumid=");
           mc_out($album->GetId() . "\">Del</a>");
       }
       else
       {
           mc_out("&nbsp;");
       }
       mc_out("</td></tr>");

       $rows++;
    }

}

</%perl>
  </table>
</td></tr>
</table> 
% if (exists $session{user} && !$nomod) {
   <center>
   [ <a href="/addtrack.html?album=<% $album->GetId() %>&artist=<% $album->GetArtist() %>">Add a missing track</a> | 
   <a href="/movealbum.html?album=<% $album->GetId() %>&artist=<% $album->GetArtist() %>">Move</a> 
%#   <a href="/mergealbum.html?album=<% $album->GetId() %>&artist=<% $album->GetArtist() %>">Merge</a> 
%    if ($album->GetArtist() != Artist::VARTIST_ID) {
      | <a href="/tomac.html?album=<% $album->GetId() %>&artist=<% $album->GetArtist() %>&track=1">Convert to multiple artists</a>
%    } else {
      | <a href="/tosac.html?album=<% $album->GetId() %>&artist=<% $album->GetArtist() %>&track=1">Convert to single artist</a>
%    }
   ]
   </center>
% }
<p>

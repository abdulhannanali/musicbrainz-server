<%args>
$artist
$album
$showids=>1
$nomod
</%args>

<%perl>

my (@ids, $di, $id, $rows, $id_numtracks, $numtracks, $duration);

$numtracks = $album->GetTrackCount();

if ($showids)
{
   $di = Discid->new($album->{DBH});
   @ids = $di->GetDiscidFromAlbum($album->GetId());
}

if (scalar(@ids) > 0) 
{
    $rows = 0;
    foreach $id (@ids)
    {
       mc_out("<tr>");
       if ($album->GetArtist() == ModDefs::VARTIST_ID) 
       {
          mc_out('<td colspan="3" ');
       }
       else
       {
          mc_out('<td colspan="2" ');
       }
       if ($id->{toc} =~ /^\d* (\d*)/)
       {
          $id_numtracks = $1;
       }
       else
       {
          $id_numtracks = undef;
       }
       if ($id->{toc} =~ /^\d* \d* (\d*)/)
       {
           my $length_in_secs = ($1 / 75);
           $duration = int($length_in_secs / 60) . ":" . 
                           sprintf("%02d",($length_in_secs % 60));
       }
       else
       {
           $duration = undef;
       }

       mc_out($id->{modpending} ? ' bgcolor="#FFFFCC"' : ' bgcolor="#ffecd6"');
       mc_out('>');
       mc_out("CD Index Id: ");

       if (defined $id_numtracks && $id_numtracks != $numtracks)
       {
           mc_out('<font color="red">');
       }
       mc_out($id->{discid});
       if (defined $id_numtracks && $id_numtracks != $numtracks)
       {
           mc_out("</font><br>This id belongs to an album that " .
                  "has $id_numtracks tracks.");
       }

       mc_out('</td><td bgcolor="#ffecd6">');
       if ($duration)
       {
           mc_out("$duration");
       }

       mc_out("</td>");
       if (exists $session{user} && !$nomod) 
       {
           mc_out("<td nowrap align=\"center\" bgcolor=\"#ffecd6\">");
           mc_out("<a href=\"/movediscid.html?discid=$id->{discid}&amp;albumid=");
           mc_out($album->GetId() . "&amp;artistid=");
           mc_out($artist->GetId() . "\">Move</a> | ");
           mc_out("<a href=\"/remdiscid.html?discid=$id->{discid}&amp;albumid=");
           mc_out($album->GetId() . "\">Del</a>");
           mc_out("</td>");
       }
       mc_out("</tr>");

       $rows++;
    }

}

</%perl>
  </table>
</td></tr>
</table> 
% if (exists $session{user} && !$nomod) {
  <table width="100%"><tr><td align="center">
%    if (!$album->IsNonAlbumTracks()) {
         [
%        if (!defined $id_numtracks || $id_numtracks > $numtracks) {
             <a href="/addtrack.html?album=<% $album->GetId() %>&amp;artist=<% $album->GetArtist() %>">Add track</a> | 
%        }
           <a href="/movealbum.html?album=<% $album->GetId() %>&amp;artist=<% $album->GetArtist() %>">Move</a> 
%            if ($album->GetArtist() != ModDefs::VARTIST_ID) {
              | <a href="/tomac.html?album=<% $album->GetId() %>&amp;artist=<% $album->GetArtist() %>&amp;track=1">Convert to multiple artists</a>
%            } else {
              | <a href="/tosac.html?album=<% $album->GetId() %>&amp;artist=<% $album->GetArtist() %>&amp;track=1">Convert to single artist</a>
%            }
         ]
%    } else {
         [ <a href="/addtrack.html?album=<% $album->GetId() %>&amp;artist=<% $album->GetArtist() %>&amp;nontrack=<% $numtracks+1 %>">Add a non-album track</a> ]
%    }
</td></tr>
</table> 
% }
<p>

<%perl>
# -----------------------------------------------------------------------------
#                               Musicbrainz.org
#                        Copyright (c) 2001 Robert Kaye
# -----------------------------------------------------------------------------
#  This software is provided "as is", without warranty of any kind, express or
#  implied, including  but not limited  to the warranties of  merchantability,
#  fitness for a particular purpose and noninfringement. In no event shall the
#  authors or  copyright  holders be  liable for any claim,  damages or  other
#  liability, whether  in an  action of  contract, tort  or otherwise, arising
#  from,  out of  or in  connection with  the software or  the  use  or  other
#  dealings in the software.
#
#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
#  Permits anyone the right to use and modify the software without limitations
#  as long as proper  credits are given  and the original  and modified source
#  code are included. Requires  that the final product, software derivate from
#  the original  source or any  software  utilizing a GPL  component, such  as
#  this, is also licensed under the GPL license.
# -----------------------------------------------------------------------------
#
# Summary:
# -----------------------------------------------------------------------------
# Render an database information box about a release
#
# $Id$
#
</%perl>
<%args>

	$album => undef
	$release => undef
	$track => undef
	$trackseq => undef

	$short => 0

</%args>
<%perl>

	die ("$album or $release are required") if (not defined $album and not defined $release);

	# use proper terminology.
	$release ||= $album;

	$release->LoadLastUpdate();
	my $lastupdate = MusicBrainz::Server::DateTime::last_update($release->GetLastUpdate());

</%perl>

	<& /comp/tablebegin, title => "Release information" &>

		<table class="formstyle">
			<tr>
				<td class="label">
					<& /comp/linkdoc, "ReleaseTitle", "Title" &>:</td>
				<td>
					<& /comp/linkrelease, release => $release &>
%					if ($session{tport}) {
					<a href="http://127.0.0.1:<% $session{tport} %>/openalbum?id=<% $release->GetMBId %>&amp;t=<% time %>"
						target="hiddeniframe" title="Open in tagger"><img
						align="absmiddle" src="/images/mblookup-tagger.png"
						alt="Open in tagger" /></a>
%					}
				</td>
			</tr>
			<tr>
				<td class="label">
					<& /comp/linkdoc, "MusicBrainzIdentifier", "MBID" &>:</td>
				<td>
					<% $release->GetMBId %></td>
			</tr>
%			if ($lastupdate) {
				<tr>
					<td class="label">
						Last updated:</td>
					<td>
						<% $lastupdate %></td>
				</tr>
%			}

%	if (not $short)
%	{

			<tr>
				<td class="label">
					Permanent link:</td>
				<td>
					<& /comp/copyable-link, "release", $release, "linkedurl" &></td>
			</tr>
			<tr>
				<td class="label">
					Fancy link:</td>
				<td>
					<a href="/show/permlink.html?id=<% $release->GetMBId %>&amp;type=release">Click here for a fancy link to this release</a></td>
			</tr>
			<tr>
				<td class="label">
					<a href="/development/mmd">XML</a>:</td>
				<td>
					<a href="<% $release->XML_URL %>"><% substr($release->XML_URL, 0, 48) . " &#8230;" |n %></a></td>
			</tr>

% 		if ($session{uid})
%		{

			<tr>
				<td class="label">
					Database Row ID:</td>
				<td>
					<% $release->GetId %></td>
			</tr>

% 		}
%	}

% 	if ($track)
%	{

			<tr>
				<td class="label">&nbsp;</td>
				<td>

%		if ($trackseq and
%			not($release->IsNonAlbumTracks))
%		{
					This track appears as <strong>track number <% $trackseq %></strong> on this release.
%		}

					[
						<a href="/edit/track/edit.html?trackid=<% $track->GetId %>&amp;releaseid=<% $release->GetId %>">Edit track</a>

%		if (not($release->IsNonAlbumTracks))
%		{

%			# TODO: calling change.html with tindex-1 might not load the correct track when
%			# the track sequence numbers have gaps.

					  | <a href="/edit/track/change.html?trackid=<% $track->GetId %>&amp;releaseid=<% $release->GetId %>&amp;tindex=<% $trackseq-1 %>&solo=1">Change artist</a>

%		}

					]

				</td>
			</tr>

%	}

		</table>


<& /comp/tableend &>

%# vi: set ts=4 sw=4 ft=mason :

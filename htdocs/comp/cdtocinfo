<%perl>
# -----------------------------------------------------------------------------
#                               Musicbrainz.org
#                        Copyright (c) 2001 Robert Kaye
# -----------------------------------------------------------------------------
#  This software is provided "as is", without warranty of any kind, express or
#  implied, including  but not limited  to the warranties of  merchantability,
#  fitness for a particular purpose and noninfringement. In no event shall the
#  authors or  copyright  holders be  liable for any claim,  damages or  other
#  liability, whether  in an  action of  contract, tort  or otherwise, arising
#  from,  out of  or in  connection with  the software or  the  use  or  other
#  dealings in the software.
#
#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
#  Permits anyone the right to use and modify the software without limitations
#  as long as proper  credits are given  and the original  and modified source
#  code are included. Requires  that the final product, software derivate from
#  the original  source or any  software  utilizing a GPL  component, such  as
#  this, is also licensed under the GPL license.
# -----------------------------------------------------------------------------
#
# Summary:
# -----------------------------------------------------------------------------
# Render an database information box about a cdtoc (Table of Contents)
#
# $Id$
#
</%perl>
<%args>

	$cdtoc

</%args>

	<& /comp/tablebegin, title => "CD TOC information" &>

		<table class="formstyle">
			<tr>
				<td class="label">
					Full TOC:</td>
				<td>
					<% $cdtoc->GetTOC %></td>
			</tr>
			<tr>
				<td class="label">
					<& /comp/linkdoc/, "DiscID", "Disc ID" &></td>
				<td>
					<% $cdtoc->GetDiscID %></td>
			</tr>
			<tr>
				<td class="label">
					FreeDB ID:</td>
				<td>
					<a href="/search/textsearch.html?query=<% uri_escape("discid:(".$cdtoc->GetFreeDBID.")") %>&type=freedb&adv=on&handlearguments=1"><% $cdtoc->GetFreeDBID %></a>
				   	(<a href="/bare/cdlookup.html?id=<%$cdtoc->GetFreeDBID %>">find other releases with this FreeDB ID</a>)
				</td>
			</tr>
% 	if ($session{uid}) {
			<tr>
				<td class="label">
					Database Row ID:</td>
				<td>
					<% $cdtoc->GetId %></td>
			</tr>
% 	}
			<tr>
				<td class="label">
					First track:</td>
				<td>
					<% $cdtoc->GetFirstTrack %></td>
			</tr>
			<tr>
				<td class="label">
					Last track:</td>
				<td>
					<% $cdtoc->GetLastTrack %></td>
			</tr>
			<tr>
				<td class="label">
					Total length:</td>
				<td>
					<% MusicBrainz::Server::Track::FormatTrackLength($cdtoc->GetLeadoutOffset / 75 * 1000) %></td>
			</tr>
			<tr class="top">
				<td class="label">
					Track details:</td>
				<td>
					<table class="listing">
						<tr class="header">
							<td>&nbsp;</td>
							<td colspan="2">Start</td>
							<td colspan="2">Length</td>
							<td colspan="2">End</td>
						</tr>
						<tr class="right header">
							<td class="center">Track</td>
							<td>Time</td>
							<td>Sectors</td>
							<td>Time</td>
							<td>Sectors</td>
							<td>Time</td>
							<td>Sectors</td>
						</tr>
<%perl>

	my $off = $cdtoc->GetTrackOffsets;
	my $len = $cdtoc->GetTrackLengths;
	my $fmt = sub { MusicBrainz::Server::Track::FormatTrackLength($_[0]/75*1000) };
	for my $n ($cdtoc->GetFirstTrack .. $cdtoc->GetLastTrack)
	{
		my $st = $off->[$n-1];
		my $ln = $len->[$n-1];

</%perl>
						<tr class="right <% ($n%2) ? 'odd' : 'even' %>">
							<td class="center"><% $n %></td>
							<td><% &$fmt($st) %></td>
							<td><% $st %></td>
							<td><% &$fmt($ln) %></td>
							<td><% $ln %></td>
							<td><% &$fmt($st+$ln) %></td>
							<td><% $st+$ln %></td>
						</tr>
% 	}
					</table>
				</td>
			</tr>
		</table>

	<& /comp/tableend &>

%# vi: set ts=4 sw=4 ft=mason :

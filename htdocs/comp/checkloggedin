<%perl>

	# slurp arguments
	my ($fHeader, $fFooter, $title, $ignoreemail) = @_;

	# define default title if it has not been passed in
	$title = "You need to login to view this page" if (not $title and not $session{uid});
	$title = "You have not provided an e-mail address" if (not $title and $session{uid});

	# some "edit" pages allow logged in users to view them even if
	# they have not completed the e-mail verification process.
	# they have to pass in the $ignoremail argument.
	my $hasConfirmedEmail = (defined $ignoreemail ? $ignoreemail : $session{has_confirmed_email});

	# if the user is logged in, and has a confirmed e-mail address,
	# the component returns true.
	return 1 if ($session{uid} and ($hasConfirmedEmail or &DBDefs::REPLICATION_TYPE != &MusicBrainz::Server::Replication::RT_MASTER));

</%perl>

%	# start page, and box output.

%	if ($fHeader)
%	{

	<& /comp/sidebar-notitle, pagetitle => $title &>

%	}

	<& /comp/tablebegin, title => $title &>

%	if ($session{uid} and not $hasConfirmedEmail)
%	{

		You have to add a working e-mail address to your account
		and complete the verification process, to be able to review other edits,
		and submit your own.

		<form method="get" action="/user/edit.html" style="margin-top: 5px">
			<input type="submit" value="Add e-mail address &raquo;" />
		</form>

		<& /comp/user/privacy &>

%	}
%	else
%	{

		<& /comp/loginbox &>

%	}

%	# finish box, and page.
	<& /comp/tableend &>

%	if ($fFooter)
%	{

	<& /comp/footer &>

%	}

%	return 0;

%# vi: set ts=4 sw=4 ft=mason :

<%args>
	$title
	$align => "left"

	$release => undef
	$artist => undef

	# manual override of the above parameters:
	$type => undef # artist or release
	$id => undef # rowid
	$mp => undef # optional moderation type argument
	$mp_type => ""	# optional moderation type argument (e.g. MOD_EDIT_ALBUMATTRS|MOD_EDIT_ALBUM_LANGUAGE...)
</%args>
<%perl>

	# we got a release parameter, fill in local variables and
	# figure out if a modpending bubble should be shown.
	my $mp_type_message = "";
	my $mp_note = "";
	my $mp_url = "";

	my $mp_release = "/mod/search/results.html?object_type=album&amp;object_id=%s&amp;mod_status=1",
	my $mp_artist = "/mod/search/results.html?artist_type=3&amp;artist_id=%s&amp;mod_status=1";

	if (defined $release)
	{
		$id = $release->GetId;
		$type = "release";
		$mp_url = sprintf($mp_release, $id);

  		SWITCH: {
			# default case, general modpending flag.
			$mp = $release->GetModPending;

			if ($mp_type == &ModDefs::MOD_EDIT_ALBUM_LANGUAGE)
			{
				$mp = $release->GetLanguageModPending;
				$mp_type_message = "edit release language";

				$mp_note = sprintf(
					qq!On batch edits, the moderations are listed
					   under the <a href="$mp_artist%s">artist</a>, not the release\! !,
					$release->GetArtist,
					"&amp;mod_type=".&ModDefs::MOD_EDIT_ALBUM_LANGUAGE);
				last SWITCH;
			}
			if ($mp_type == &ModDefs::MOD_EDIT_ALBUMATTRS)
			{
				$mp = $release->GetAttributeModPending;
				$mp_type_message = "release attributes";
				last SWITCH;
			}
		}
	}
	elsif ($artist)
	{
		$id = $artist->GetId;
		$type = "artist";
		$mp_url = sprintf($mp_artist, $id);

		SWITCH: {
			# default case, general modpending flag.
			$mp = $artist->GetModPending;

			 # there are not methods which provide details of
			 # pending artist moderation types
			if ($mp_type == &ModDefs::MOD_EDIT_ARTIST) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTALIAS) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTNAME) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTSORTNAME) { };
		}

	}

	$m->out(qq!<div class="orangeheader"> !);
	$m->out(qq!  <div class="inner"><b>$title</b></div> !);
	$m->out(qq!</div> !);

	if ($mp)
	{
		if ($type && $id)
		{

			my $typestr = ucfirst($type);
			$typestr = "Release" if ($typestr eq "Album");

			$m->out(qq!<table class="modpending"><tr><td> !);
			$m->out(sprintf qq! 	There are pending %smoderations for !, "$mp_type_message ");
			$m->out(qq! 	this $typestr. Click <img src="/images/edit.gif" alt="" /><a href="$mp_url">here</a> !);
			$m->out(qq! 	to review the changes. !);
			$m->out(qq!</td></tr><tr><td class="note">$mp_note</td></tr> !) if ($mp_note ne "");
			$m->out(qq!</table> !);
		}
		else
		{
			$m->out(qq!<table class="modpending"><tr><td> !);
			$m->out(sprintf qq! 	Yellow highlights indicate pending %smoderations. !, "$mp_type_message ");
			$m->out(qq!</td></tr></table> !);
		}
	}

	$m->out(qq!<div class="boxcontent"> !);
	$m->out(qq!	<div class="inner" style="text-align: $align"> !);


</%perl>





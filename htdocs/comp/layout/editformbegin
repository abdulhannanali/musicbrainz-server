<%args>
	$title
	$align => "left"

	$release => undef
	$artist => undef

	# manual override of the above parameters:
	$type => undef # artist or release
	$id => undef # rowid
	$mp => undef # optional moderation type argument
	$mp_type => ""	# optional moderation type argument (e.g. MOD_EDIT_ALBUMATTRS|MOD_EDIT_ALBUM_LANGUAGE...)
</%args>
<%perl>

	# we got a release parameter, fill in local variables and
	# figure out if a modpending bubble should be shown.
	my $mp_type_message = "";
	my $mp_note = "";
	my $mp_url = "";

	my $mp_release = "/mod/search/results.html?object_type=album&amp;object_id=%s&amp;mod_status=1&amp;mod_status=8",
	my $mp_artist = "/mod/search/results.html?artist_type=3&amp;artist_id=%s&amp;mod_status=1&amp;mod_status=8";

	if (defined $release)
	{
		$id = $release->GetId;
		$type = "release";
		$mp_url = sprintf($mp_release, $id);

  		SWITCH: {
			# default case, general modpending flag.
			my $editfilter = "";

			if ($mp_type != &ModDefs::MOD_EDIT_ALBUM_LANGUAGE and
				$mp_type != &ModDefs::MOD_EDIT_ALBUMATTRS)
			{
				$mp = $release->GetModPending;
			}

			if ($mp_type == &ModDefs::MOD_EDIT_ALBUM_LANGUAGE)
			{
				$mp = $release->GetLanguageModPending;
				$mp_type_message = "edit release language";
				$editfilter = "&amp;mod_type=".&ModDefs::MOD_EDIT_ALBUM_LANGUAGE;
				last SWITCH;
			}
			if ($mp_type == &ModDefs::MOD_EDIT_ALBUMATTRS)
			{
				$mp = $release->GetAttributeModPending;
				$mp_type_message = "release attributes";
				$editfilter = "&amp;mod_type=".&ModDefs::MOD_EDIT_ALBUMATTRS;
				last SWITCH;
			}
			$mp_note = sprintf(
				qq!Batch edits for multiple releases are listed under
				   the <a href="$mp_artist%s%s">artist</a>, not the release. !,
				$release->GetArtist,
				$editfilter);
		}
	}
	elsif ($artist)
	{
		$id = $artist->GetId;
		$type = "artist";
		$mp_url = sprintf($mp_artist, $id);

		SWITCH: {
			# default case, general modpending flag.
			$mp = $artist->GetModPending;

			 # there are not methods which provide details of
			 # pending artist moderation types
			if ($mp_type == &ModDefs::MOD_EDIT_ARTIST) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTALIAS) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTNAME) { };
			if ($mp_type == &ModDefs::MOD_EDIT_ARTISTSORTNAME) { };
		}

	}

	$m->out(qq!<div class="orangeheader"> !);
	$m->out(qq!  <div class="inner"><b>$title</b></div> !);
	$m->out(qq!</div> !);

	$m->out(qq!<div class="boxcontent"> !);
	$m->out(qq!	<div class="inner" style="text-align: $align"> !);

	if ($mp)
	{
		if ($type && $id)
		{
			$type = "release" if ($type eq "album");

			$m->out(qq!<table class="modpending"><tr><td> !);
			$m->out(sprintf qq! 	There are pending %smoderations for !, "$mp_type_message ");
			$m->out(qq! 	this $type. Please <a href="$mp_url">review the changes</a> !);
			$m->out(qq! 	before entering a new edit. !);
			$m->out(qq!</td></tr>!);
			$m->out(qq!<tr><td class="note">$mp_note</td></tr> !) if ($mp_note ne "");
			$m->out(qq!</table> !);
		}
		else
		{
			$m->out(qq!<table class="modpending"><tr><td> !);
			$m->out(sprintf qq! 	Yellow highlights indicate pending %smoderations. !, "$mp_type_message ");
			$m->out(qq!</td></tr></table> !);
		}
	}

</%perl>





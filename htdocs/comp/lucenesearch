<%args>

	$type => "artist"
	$limit => 25
	$query => ""
	$tport=>$session{'tport'}

</%args>
<%perl>

	$type = lc $type;
	$limit = 25 if ($limit < 1 || $limit > 100);

	UserStuff::EnsureSessionOpen(), $session{tport} = $tport
	  if $tport;

	my $oldsearch = '/search/oldsearch.html?limit=' . $limit . '&table=' . ($type eq 'release' ? 'album' : $type) . '&search=' . uri_escape($query);

</%perl>

<form method="get" action="/search/textsearch.html" class="formstyle" id="TextSearchForm">
	<table class="formstyle">
		<tr>
			<td class="labelnopad"><label for="id_query">Search for:</label></td>
			<td>
				<input type="text" name="query" id="id_query" value="<% $query %>" size="30" /></td>
		</tr>
		<tr>
			<td class="labelnopad"><label for="id_type">Type:</label></td>
			<td>
				<select name="type" id="id_type">
%					$m->out(qq!<option value="artist" ! . ($type eq "artist" ? 'selected="selected"' : '') . qq!>Artists</option>!);
%					$m->out(qq!<option value="release" ! . ($type eq "release" ? 'selected="selected"' : '') . qq!>Releases</option>!);
%					$m->out(qq!<option value="track" ! . ($type eq "track" ? 'selected="selected"' : '') . qq!>Tracks</option>!);
				</select></td>
		</tr>
		<tr>
			<td class="labelnopad"><label for="id_limit">Limit to:</label></td>
			<td>
				<select name="limit" id="id_limit">
%					$m->out(qq!<option value="25" ! . ($limit eq 25 ? 'selected="selected"' : '') . qq!>Up to 25</option>!);
%					$m->out(qq!<option value="50" ! . ($limit eq 50 ? 'selected="selected"' : '') . qq!>Up to 50</option>!);
%					$m->out(qq!<option value="100" ! . ($limit eq 100 ? 'selected="selected"' : '') . qq!>Up to 100</option>!);
			  </select></td>
		</tr>
		<tr>
			<td></td>
			<td>
				<input type="submit" value="Indexed Search &raquo;" title="Start search..."/></td>
		</tr>
		<tr>
			<td></td>
			<td>
				[ <a href="<% $oldsearch %>" title="Search for the same query using the Direct Search...">direct search</a> ]&nbsp;&nbsp;[ <a href="/popup/TextSearchSyntax" title="POPUP::TextSearchSyntax::400::400">help</a> ]</td>
		</tr>
	</table>
</form>

%# vi: set ts=4 sw=4 ft=mason :

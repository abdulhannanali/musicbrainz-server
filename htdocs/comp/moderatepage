<%args>
$type
</%args>

<%perl>

my ($mb, @info, $mod, $offset, $i, $comp, $obj);
my ($option1, $option2, $num_mods, $total_mods, $notes);
my $max_items = 10;

$mb = new MusicBrainz;  

$offset = $ARGS{offset};
$offset = 0 if not defined $offset;
$offset = 0 if $offset < 0;  

$mb->Login();
$mod = Moderation->new($mb->{DBH});

my $freedb_note = 0;
if ($type == ModDefs::TYPE_NEW)
{
    ($num_mods, $total_mods, @info) = 
           $mod->GetModerationList($offset, $max_items, $session{uid}, $type);
    mc_comp("/comp/sidebar", title=>'Review Pending Moderations',
            expand=>"moderate"); 
    $option1 = '<a href="moderate.html?type=2">Old Moderations</a>';
    $option2 = '<a href="moderate.html?type=3">My Moderations</a>';

    foreach $obj (@info)
    {
        if ($obj->GetModeratorName() eq "FreeDB")
        {
            $freedb_note = 1;
            last;
        }
    }
}
elsif ($type == ModDefs::TYPE_VOTED)
{
    ($num_mods, $total_mods, @info) = 
           $mod->GetModerationList($offset, ($max_items * 2)+1, 
                                   $session{uid}, $type);
    mc_comp("/comp/sidebar", title=>'Review Old (Voted) Moderations',
            expand=>"moderate"); 
    $option1 = '<a href="moderate.html?type=1">New Moderations</a>';
    $option2 = '<a href="moderate.html?type=3">My Moderations</a>';
}
else
{
    ($num_mods, $total_mods, @info) = 
           $mod->GetModerationList($offset, ($max_items * 2)+1, 
                                   $session{uid}, $type);
    mc_comp("/comp/sidebar", title=>'Review My Moderations',
            expand=>"moderate"); 
    $option1 = '<a href="moderate.html?type=1">New Moderations</a>';
    $option2 = '<a href="moderate.html?type=2">Old Moderations</a>';
}

if ($num_mods > 0)
{
   $notes = $mod->LoadModerationNotes($info[0]->GetId(), 
                                   $info[$num_mods-1]->GetId());
}
</%perl>

<form method="POST" action="/bare/vote.html"
      enctype="application/x-www-form-urlencoded" class="formstyle"> 

<table width=100%>
<tr>
  <td width="25%" align="center" valign="top">
      <% $total_mods + $offset %> mods 
      <% $type == ModDefs::TYPE_NEW ? 'pending' : 'total' %>
  </td>
  <td width="25%" align="center" valign="top">
%    mc_out($option1);
  </td>
  <td width="25%" align="center" valign="top">
%    mc_out($option2);
  </td>
  <td width="25%" align="center" valign="top">
     <a href="mod_intro.html">Questions?</a>
  </td>
</tr>
% if ($freedb_note) {
  <tr><td colspan="4" align="center">
  <font color="red" size="+1">Note:</font> This page contains automatic
  Album insertions from moderator FreeDB.<br> If these do not seem 
  correct/appropriate, then vote no. 
  <a href="/cd_submission.html">More Info</a> 
  </td></tr>
% }
</table>

% if ($num_mods == 0) {
   <center>
   <br><br>
%  if ($type == ModDefs::TYPE_NEW) {
   There are no new modifications pending.
%  } elsif ($type == ModDefs::TYPE_VOTED) {
   There are no old (voted on) modifications.
%  } else {
   You have not made any modifications.
%  }
   </center>
%}

% if ($num_mods > $max_items || $offset > 0) {
<table width="100%">
<tr><td bgcolor=white class="body">
<& /comp/prevnextbuttons, 
   url=>"moderate.html?type=$type",
   offset=>$offset,
   itemsperpage=>$max_items,
   totalitems=>$num_mods
&>
</td></tr></table>
% }

<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0"
       BGCOLOR="#000000" WIDTH="100%">
<TR><TD width="100%">
<TABLE WIDTH="100%" BORDER="0" CELLSPACING="1" CELLPADDING="3">

<%perl>
for($i = 0; $i < $max_items; $i++) 
{
   $obj = $info[$i];
   last if (!defined $obj);

   mc_comp("/comp/showmod", mod=>$obj, mode=>$type, notes=>$notes);
}
$mb->Logout();
</%perl>

</table>
</td></tr>
</table>

% if ($num_mods > $max_items || $offset > 0) {
<table width="100%">
<tr><td bgcolor=white class="body">
<& /comp/prevnextbuttons, 
   url=>"moderate.html?type=$type",
   offset=>$offset,
   itemsperpage=>$max_items,
   totalitems=>$num_mods
&>
</td></tr></table>
% }

% if ($num_mods > 0 && $type == ModDefs::TYPE_NEW) {
<table width=100%>
<tr>
  <td width=20%>
     &nbsp;
  </td>
  <td align=right>
     Click here to vote on the items on this page:
     <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">
  </td>
</tr>
</table>
%}

</form>

<%perl>

# I used to have an %args block here but Mason kept crashing on it
my $pagesize = $ARGS{pagesize};
my $url = $ARGS{url};
my $numitems = $ARGS{numitems};
my $numlinks = $ARGS{numlinks};

print STDERR "$numitems\n";

my ($frontpages, $backpages);

my $totalpages = $numitems / $pagesize;
return undef if ($totalpages < 1);

if ($totalpages < $numlinks)
{
   $frontpages = $totalpages;
   $backpages = 0;
}
else
{
   $frontpages = $numlinks / 2;
   $backpages = $numlinks / 2;
}

</%perl>

<table width="100%"><tr><td align="center">
% my ($i);
  [&nbsp;
% for($i = 0; $i < $frontpages; $i++) {
    <a href="<% $url %>&offset=<% $i * $pagesize %>"><% $i + 1 %></a>&nbsp;
% }
% if ($backpages > 0) {
      ... &nbsp;
%     for($i = int($totalpages - $backpages); $i < $totalpages; $i++) {
         <a href="<% $url %>&offset=<% $i * $pagesize %>"><% $i + 1 %></a>&nbsp;
%     }
% }
  ]
</td></tr></table>


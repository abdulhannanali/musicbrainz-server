<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# Render the Disc IDs, and Release Events of a release
	#
	# $URL$
	# $Id$
	#
</%perl>
<%args>
	$artist
	$album

	$showids => 1
	$showreleases => 0
	$showmodlinks => 1
	$showtrackartists => 0
</%args>
<%perl>
	my $release = $album;

	my $releaseid = $release->GetId;
	my $isva = $release->HasMultipleTrackArtists || $showtrackartists;

	if ($showids)
	{
		my @ids = @{ $release->GetDiscIDs };

		if (scalar(@ids) > 0)
		{

			foreach my $id (@ids)
			{
				my $cdtoc = $id->GetCDTOC;
				my $duration = Track::FormatTrackLength($cdtoc->GetLeadoutOffset / 75 * 1000);
				my $id_numtracks = $cdtoc->GetTrackCount;
				my $discid = $cdtoc->GetDiscID;
				my $mismatch = (defined $id_numtracks and
							 	$id_numtracks != $release->GetTrackCount);

				# 1. TOC
				my $colspan = ($isva ? 3 : 2);
</%perl>
				<tr class="discid">
					<td class="toc" colspan="<% $colspan %>">Disc ID:

%				$m->out(qq!<span class="mp">!) if ($id->GetModPending);

						<a href="/showcdtoc.html?id=<% $cdtoc->GetId %>"><% $discid %></a>

%				# print a warning if the toc has different number of tracks
%				# than the release.
%				if ($mismatch) {
						<span class="mismatch">
							<br />This id belongs to a release that has <% $id_numtracks %> tracks.
						</span>
%				}
%				$m->out(qq!</span>!) if ($id->GetModPending);

					</td>

					<td class="length"><% $duration %></td>

%				# 3. Edit Links
%				if ($session{uid} and $showmodlinks)
%				{
%					my $tocid = $cdtoc->GetId();

					<td class="links">
						<a href="/edit/discid/move.html?tocid=<% $tocid %>&amp;releaseid=<% $releaseid %>"
							title="Move Disc ID to another release">Move</a> |

						<a href="/edit/discid/remove.html?tocid=<% $tocid %>&amp;releaseid=<% $releaseid %>"
							title="Remove this Disc ID from the Release">Remove</a>
					</td>
%				}
				</tr>
%			}
%		}
%	}
	</table>


%	if ($showreleases and not $release->IsNonAlbumTracks)
%	{

	<table id="releaseevents::<% $releaseid %>" class="releaseevents">
		<tr valign="top">
			<td class="eventslist">

%		my @relevents = $release->Releases;
%		if (@relevents == 0)
%		{
			No release events
%		}
%		else
%		{
%			my %country_names;
%			my $country_obj = MusicBrainz::Server::Country->new($release->{DBH});

				<table class="eventslist">
%			my $first = 1;
%			for my $rel (@relevents)
%			{
%				# Country
%				my $cid = $rel->GetCountry;
%				my $name = (
%					$country_names{$cid} ||= do {
%						my $c = $country_obj->newFromId($cid);
%						$c ? $c->GetName : "?";
%					}
%				);

					<tr <% $rel->GetModPending ? qq! class="mp"! : "" |n %>>
						<td><& /comp/releasedate, $rel &></td>
						<td>&mdash;</td>
						<td><% $name %></td>
					</tr>
%			}
				</table>
%		}
			</td>

%		if ($showmodlinks)
%		{
			<td class="links">
				<a href="/edit/albumreleases/index.html?releaseid=<% $releaseid %>"
					title="Add, Edit and Remove Release Events of this Release">Edit Release Events</a></td>
%		}
		</tr>
	</table>
%	}

%	# add some spacing after the release.
	<div class="release_endspacer">&nbsp;</div>



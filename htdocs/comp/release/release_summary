<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# Render the release meta data (count of Tracks, Disc IDs, TRM Ids PUIDs),
	# the release language and attributes.
	#
	# $Id$
	#
</%perl>
<%args>

	$album
	$artist

	$showeditlinks
	$showtrackartists

</%args>
<%perl>

	my $release = $album;

	# track artist are either shown, if there are track artists != release artist
	# or if the link "show track artists" was clicked.
	my $isva = $release->HasMultipleTrackArtists || $showtrackartists;

	my $colspan = 3;
	$colspan++ if ($showeditlinks);
	$colspan++ if ($isva);

	my $trackcount = $release->GetTrackCount();
	my $trmids = $release->GetTrmidCount();
	my $puids = $release->GetPuidCount();
	my $discids = $release->GetDiscidCount();
	my $quality = ModDefs::GetQualityText($release->GetQuality);

</%perl>

	<tr class="summary">
		<td colspan="<% $colspan %>">
			<table class="releasesummary">
				<tr>
					<td class="statistics">
						<span class="tracks">
							<% $trackcount %>
							<img src="/images/notes.gif" alt="Tracks" title="This release has <% $trackcount %> tracks" />
						</span>

% 	if ($discids > 0)
%	{
						<span class="discid">
							<% $discids %>
							<img src="/images/cd.gif" alt="CD" title="This release has <% $discids %> DiscIDs" />
						</span>
%	}

%	if ($puids > 0)
%	{
						<span class="puid">
							<% $puids %>
							<img src="/images/puid.gif" width="35" height="13" alt="PUID" title="This release has <% $puids %> PUIDs" />
						</span>
% 	}

%	if ($trmids > 0)
%	{
						<span class="trmid">
							<% $trmids %>
							<img src="/images/trm.gif" alt="TRM" title="This release has <% $trmids %> TRM IDs" />
						</span>
% 	}
					</td>
					<td class="language">
                    [ <% $quality %> data quality ]
%					if ($session{"uid"} and $showeditlinks)
%					{
				    <a href="/edit/albumquality/edit.html?id=<% $release->GetId() %>">Change</a>
%					}
					|
<%perl>

	# 2. Release Language
	my $editwhat = "&nbsp;Language";
	my $nonalbum = $release->IsNonAlbumTracks();
	if (!$nonalbum)
	{
		my $language = $release->GetLanguage;
		my $script = $release->GetScript;

		$m->out(qq![&nbsp;<a href="/popup/ReleaseLanguage" title="POPUP::Release_Language::400::300">!);
		$m->out(sprintf qq!<span%s>%s, %s</span>!,
				$release->GetLanguageModPending() ? qq! class="mp"! : "",
				$language ? $language->GetName() : "?",
				$script ?  $script->GetName() : "?");

		$editwhat = "";
		$m->out("</a>&nbsp;]");

		if ($session{"uid"} and $showeditlinks)
		{
			$m->out(sprintf qq!&nbsp;<a href="/edit/albumlanguage/edit.html?id=%s" title="%s">Edit%s</a>!,
							$release->GetId(),
							"Edit language and script of this release",
							$editwhat);
		}
		$m->out(qq!&nbsp;|</td>\n!);


		# 3. Release Attributes
		$m->out(qq!<td class="attributes">[&nbsp;!);
		if (!$nonalbum)
		{
			# get attributes, and sort such that we have type, status order.
			my @attrs = $release->GetAttributes();
			@attrs = sort { $a <=> $b } @attrs;

			$m->out(qq!<a href="/popup/ReleaseAttribute" title="POPUP::Release_Attributes::400::300">!);
			if (@attrs > 0)
			{
				$m->out(sprintf qq!<span%s>!, $release->GetAttributeModPending() ? qq! class="mp"! : "");

				my $count = 0;
				for my $attr (@attrs)
				{
					my $attrname = $release->GetAttributeName($attr) || "?";
					$m->out(",&nbsp;") if ($count > 0);
					$m->out($attrname);
					$count++;
				}

				$m->out("</span>");
			}
			else
			{
				$m->out("None");
			}
			$m->out("</a>&nbsp;]");
		}

		if ($session{"uid"} and $showeditlinks)
		{
			$m->out(sprintf qq!&nbsp;<a href="/edit/album/editattributes.html?id=%s" title="%s">Edit</a>!,
							$release->GetId(),
							"Edit release attributes of this release",);
		}
	}

</%perl>

					</td>
				</tr>
			</table>
		</td>
	</tr>

%# vi: set ts=4 sw=4 ft=mason :

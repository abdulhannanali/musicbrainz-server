<%args>
$mod
$notes
</%args>

<%perl>

my ($ref, $obj, $bold);
my $voted = $mod->GetVote();
if (!defined $voted)
{
   $voted = &ModDefs::VOTE_NOTVOTED;
}

my $expired = ($mod->GetExpired() ? "d" : "s");

my $time = $mod->GetExpireTime();
$time = $m->comp("/comp/datetime", $time);

</%perl>

<tr>
<td bgcolor="#FFBA58" colspan=3><img src="/images/pixel.gif" width="1" height="1" alt="" border=""></td>
</tr>
<tr>
   <td width="37%" valign=top bgcolor=white class="body" nowrap>
     By: <a href="/moderator.html?uid=<% $mod->GetModerator() %>"><span class="bold"><% $mod->GetModeratorName() |n %></span></a>
     &nbsp;&nbsp;&nbsp;
     <a href="/showmod.html?modid=<% $mod->GetId() %>"
        title="View moderation detail">Id: <% $mod->GetId() %></a><br> 
     Expire<% $expired %>: <% $time %>
   </td>
   <td width="37%" valign=top bgcolor=white class="body">
     <% $mod->ShowModType($m), "" %> 
   </td>
   <td width="30%" align=center valign=top valign=top bgcolor=white class="body" NOWRAP>
%    if ($session{uid} == $mod->GetModerator() || 
%        $mod->GetStatus() != &ModDefs::STATUS_OPEN ||
%        $voted != &ModDefs::VOTE_NOTVOTED) {
           <% $mod->GetYesVotes() |n %> yes,
           <% $mod->GetNoVotes() |n %> no
           &nbsp;&nbsp; 
%    }
     <br>[ <a href="/mod/addnote.html?modid=<% $mod->GetId %>" onclick="MyWindow=window.open('mod/addnote.html?modid=<% $mod->GetId %>','AddNote','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=400,height=150'); return false;">Add note</a> |
     <a href="/user/mod_email.html?uid=<% $mod->GetModerator() %>&modid=<% $mod->GetId() %>&url=<% $r->uri() . "?" . $r->args() %>">Send email</a> ]
% if ($session{uid} == $mod->GetModerator() &&
%     $mod->GetStatus() == &ModDefs::STATUS_OPEN) {
     <a href="/removemod.html?modid=<% $mod->GetId() %>"><img 
        src="/images/remove.gif" alt="remove" title="Remove this moderation"
        border="0" height="16" width="16" align="center"></a>
% }
% if ($mod->GetAutomod()) {
     <img src="/images/automod.png" alt="automod" 
          title="This is an automod moderation" border="0" height="16" 
          width="16" align="center">
% }
   </td>
</tr>
<tr>

   <td width="37%" valign=top bgcolor="#ffecd6" class="body">
     <% $mod->ShowPreviousValue($m), "" %> 
   </td>

   <td width="37%" valign=top bgcolor="#f0efff" class="body">
     <% $mod->ShowNewValue($m), "" %> 
   </td>

   <td width="30%" align=center valign=top bgcolor=white class="body" nowrap>

% if ($session{uid} == $mod->GetModerator()) {
     <% $mod->GetChangeName() |n %>
% } elsif ($voted == &ModDefs::VOTE_YES || $voted == &ModDefs::VOTE_NO ||
%          $voted == &ModDefs::VOTE_ABS) {
     Your vote: <% $mod->GetVoteText($voted) |n %><br>

     <% $mod->GetChangeName() |n %>
% } elsif ($session{uid} != $mod->GetModerator() && 
%          $mod->GetStatus() == &ModDefs::STATUS_OPEN &&
%          $voted == &ModDefs::VOTE_NOTVOTED) {
     <label for="rowid<% $mod->GetId() %>-yes">Yes</label>&nbsp;<input type="radio" name="rowid<% $mod->GetId() %>" id="rowid<% $mod->GetId() %>-yes" value="yes">&nbsp;
     <label for="rowid<% $mod->GetId() %>-no">No</label>&nbsp;<input type="radio" name="rowid<% $mod->GetId() %>"  id="rowid<% $mod->GetId() %>-no" value="no">&nbsp;
     <label for="rowid<% $mod->GetId() %>-abst">Abst</label>&nbsp;<input type="radio" name="rowid<% $mod->GetId() %>" id="rowid<% $mod->GetId() %>-abst" value="abs" CHECKED>
% } else {
     <% $mod->GetChangeName() |n %>
% }
   </td>

</tr>

% if (exists $notes->{ $mod->GetId() }) {
<tr>
   <td colspan="3" valign=top bgcolor=white class="body">
%    $ref = $notes->{ $mod->GetId() };
     Notes:<br>
%    foreach $obj (@$ref) {
        &nbsp;&nbsp;&nbsp;&nbsp;
%       $bold = ($obj->{user} eq $mod->GetModeratorName()) ? 'bold' : 'body';
        <a href="/moderator.html?uid=<% $obj->{uid} %>"
	    ><font class="<% $bold %>"><% $obj->{user} %></font></a>:
        <% $obj->{text} %><br> 
%    }
   </td>
</tr>
% }

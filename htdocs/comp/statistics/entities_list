<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# A dashboard that shows what is currently happening inside MusicBrainz
	#
	# $Id: permlink.html 8548 2006-10-19 07:41:02Z dave $
	#
</%perl>
<%args>
	$data
	$type 
	$timestamp
	$pager => 0
	$numitems
	$maxitems => 25
	$offset => 0
	$date => ''
</%args>

<%perl>
my ($item, $count, $name);
$name = "recent_$type" . "s";

my $args = {type=>$name};
$args->{date} = $date if ($date);
</%perl>

<table style="width: 100%; background-color: #fafafa; border: 1px #000000 solid; padding: 10px;">
<tr> 
	<td><b><% ucfirst($type) %></b></td> 
%	if (!$date) {
		<td><b>Updated</b></td>
%	}
</tr>
% foreach $item (@$data) {
    <tr>
	    <td>
%		if ($date) {
			<span class="link<% $type %>-icon"><a href="/<% $type %>/<% $item->[0] %>.html"><% $item->[1] %></a></span><br/>
%		} else {
%			$count = 0;
%			foreach $date (@{$item->[1]}) {
				<span class="link<% $type %>-icon"><a href="/<% $type %>/<% $date->[0] %>.html"><% $date->[1] %></a></span><br/>
%				if ($count++ == 2) {
					[ <a href="/show/stats/dashboard.html?date=<% uri_escape($item->[0]) %>&type=recent_<% $type %>s">See all 
					<% scalar(@{$item->[1]}) %> items</a> ]
%					last;
%				}
%			}
%		}
		</td>
%		if (!$date) {
		    <td valign="top" NOWRAP><% MusicBrainz::Server::DateTime::format_datetime_since($item->[0]) %></td>
%		}
    </tr>
% }
%   if ($pager) {
        <tr>
            <td colspan="5">
			   <& /comp/pageselector, offset => $offset, pagesize => $maxitems, 
			                          url => '/show/stats/dashboard.html',
									  args => $args,
									  numitems => $numitems &>
            </td>
        </tr>
%   } else {
        <tr>
            <td colspan="5">
            [ <a href="dashboard.html?type=<% $name %>">see more recently changed <% $type . "s" %></a> ]
            </td>
        </tr>
%	}
</table>
<p class="lastupdated">Updated <% $timestamp %></p>
%# vi: set ts=4 sw=4 ft=mason :

<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# A dashboard that shows what is currently happening inside MusicBrainz
	#
	# $Id: permlink.html 8548 2006-10-19 07:41:02Z dave $
	#
</%perl>
<%args>
	$data
	$type 
	$timestamp
	$pager => 0
	$numitems
	$maxitems => 25
	$offset => 0
	$date => ''
</%args>

<%perl>
my ($item, $count, $name);
$name = "recent_$type" . "s";

my $args = {type=>$name};
my $coutn = 0;
$args->{date} = $date if ($date);
</%perl>

<table class="datatable">
<tr> 
	<td><b><% ucfirst($type) %></b></td> 
%	if (!$date) {
		<td><b>Age</b></td>
%		if ($pager) {
			<td><b>Last updated</b></td>
%		}
%	}
</tr>
% foreach $item (@$data) {
%	$count++;
    <tr class="datatable<% ("odd", "even")[++$. % 2] %>">

	    <td width="75%">
%		if ($date) {
			<span class="link<% $type %>-icon"><a href="/<% $type %>/<% $item->[0] %>.html"><% $item->[1] %></a></span><br/>
%		} else {
%			$count = 0;
%			foreach $date (@{$item->[1]}) {
				<span class="link<% $type %>-icon"><a href="/<% $type %>/<% $date->[0] %>.html"><% $date->[1] %></a></span><br/>
%				if ($count++ == 2 && scalar(@{$item->[1]}) > 3) {
%					last;
%				}
%			}
%		}
		</td>
%		if (!$date) {
		    <td valign="top" align="center" NOWRAP>
				<% MusicBrainz::Server::DateTime::format_datetime_since($item->[0]) %>
%			if (scalar(@{$item->[1]}) > 3) {
				<br/><br/><a href="/show/stats/dashboard.html?date=<% uri_escape($item->[0]) %>&type=recent_<% $type %>s">See all 
				<% scalar(@{$item->[1]}) %> items</a>
%			}
			</td>
%			if ($pager) {
				<td valign="top" align="center" NOWRAP>
					<% MusicBrainz::Server::DateTime::format_datetime($item->[0]) %>
				</td>
%			}
%		}
    </tr>
% }
%   if ($pager) {
%		if ($numitems > $maxitems) {
			<tr class="datatablefooter">
				<td colspan="5">
				   <& /comp/pageselector, offset => $offset, pagesize => $maxitems, 
										  url => '/show/stats/dashboard.html',
										  args => $args,
										  numitems => $numitems &>
				</td>
			</tr>
%		}
%   } else {
        <tr class="datatablefooter">
            <td colspan="5">
%			if ($numitems) {
				<a href="dashboard.html?type=<% $name %>">see more recently changed <% $type . "s" %></a>
%			} else {
				The are no recently changed <% $type . "s" %>.
%			}
            </td>
        </tr>
%	}
</table>
<p class="lastupdated">Updated <% $timestamp %></p>
%# vi: set ts=4 sw=4 ft=mason :

<%perl>

sub StatLine
{
    my ($title, $count) = @_;

    my $r = "<tr><TD valign=top align=right class=\"statsb\">$title</TD>";
    $r .= "<TD valign=top class=\"stats\">$count</td></tr>";
    return $r;
}

my $result = $m->cache(action=>'retrieve');
if (!defined($result)) 
{
    my $mb = mc_comp("/comp/dblogin", quiet=>1);

    if (defined $mb)
    {
			my $stat = Statistic->new($mb->{DBH});
			my %stats = %{ $stat->FetchAllAsHashRef };

			$result = StatLine("Artists", $stats{'count.artist'});
			$result .= StatLine("Albums", $stats{'count.album'});
			$result .= StatLine("Tracks", $stats{'count.track'});
			$result .= StatLine("Discids", $stats{'count.discid'});
			$result .= StatLine("TRM Ids", $stats{'count.trm'});
			$result .= StatLine("Mods", $stats{'count.moderation'});
			$result .= StatLine("Users", $stats{'count.moderator'});

			$m->cache(action=>'store', expire_next=>'hour', value=>$result);
			$mb->Logout();
		}
}
</%perl>

<table cellpadding="2" cellspacing="0" border="0" class="statsb" width="110px">
	<col style="width: 50%">
	<col style="width: 50%">
	<% $result |n %>
</table>  

<div class="SideBarMoreLink">
	<span class="sidemenusmall"> 
		<a href="/stats.html">more &gt;&gt;</a>
	</span>
</div>

<!-- vi: set ts=2 sw=2 ft=mason : -->

<%perl>

sub StatLine
{
    my ($title, $count) = @_;

    my $r = "<tr><TD valign=top align=right class=\"statsb\">$title</TD>";
    $r .= "<TD valign=top class=\"stats\">$count</td></tr>";
    return $r;
}

my $result = $m->cache(action=>'retrieve');
#$result = undef;
if (!defined($result)) 
{
    my $mb = mc_comp("/comp/dblogin", quiet=>1);

    if (defined $mb)
    {
        my $sql = Sql->new($mb->{DBH});
        if ($sql->Select(qq|select artists, albums, tracks, discids, trmids, 
                                   moderations, moderators 
                              from Stats 
                             where timestamp = current_date()|))
        {
             my @row = $sql->NextRow;
             $sql->Finish();

             $result = StatLine("Artists", $row[0]);
             $result .= StatLine("Albums", $row[1]);
             $result .= StatLine("Tracks", $row[2]);
             $result .= StatLine("Discids", $row[3]);
             $result .= StatLine("TRM Ids", $row[4]);
             $result .= StatLine("Mods", $row[5]);
             $result .= StatLine("Users", $row[6]);

	     $result = "<table>$result</table>";

             $m->cache(action=>'store', expire_next=>'day', value=>$result);
        }
        else
        {
             $result = "[ Updating ]";
        }
        $mb->Logout();
    }
}
</%perl>

<table cellpadding="10" cellspacing="0" border="0">
<tr>
   <td>
      <table width="100%">
        <tr><td align="center" class="statsb"><% $result |n %></td></tr>
      </table>
   </td>
</tr>
</table>  

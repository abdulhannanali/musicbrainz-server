<& /comp/sidebar, title=>"TunePimp Library Documentation" &>

<& /comp/section, title=>'Introduction' &>

<p>
The <a href="/products/tunepimp/index.html">TunePimp library</a>
serves as a tool to allow developers to create MusicBrainz enabled 
tagging applications. 
</p>

<p>
The TunePimp library is a full featured tagging library that allows the
developer to open music files for identification/lookup. Once files have
been identified, it writes new metadata tags to the music files and writes
the files to a standardized directory hierarchy. TunePimp includes
the following features:
</p>

<ul>
<li>Create TRM IDs from WAV, MP3, Ogg/Vorbis and FLAC files
<li>Automatically lookup files by TRM or by metadata
<li>Read and write metadata from the music files
<li>Optionally rename files according to a user specified file mask
<li>Optionally move files to a user specified directory hierarchy
</ul>

<p> 
The TunePimp library source distribution comes with two example programs:
</p>

<ul>
<li>examples/tp_tagger.c: This command line application is a full fledged tagging application
    that shows how to use the TunePimp library to create a tagging application. If you
    are considering using the TunePimp library in your application, please make sure to 
    read through the source code of this example application. The documentation in this page 
    is fairly brief and the tp_tagger source code is a great illustration on how to use
    the TunePimp library.</li>
<li>perl/tunepimp-perl/examples/tp_tagger.pl: This example implements the tp_tagger using
    the perl bindings.</li>
<li>examples/trm.c: This example shows how to use TunePimp to calculate TRM IDs for
    music files from the command line.</li>
<li>python/examples/trm.py: The same application, but it uses the python bindings to 
    create TRM IDs.</li>
</ul>

<p>
If you prefer to read code than documentation in order to learn this
client library, please check out these code samples.
</p>

<p>
The client library is released under the 
<a href="http://www.gnu.org/copyleft/gpl.html">GPL</a>. If you wish to use tunepimp
in an <a href="http://www.gnu.org/copyleft/gpl.html">LGPL</a> project, you will need to 
use the --enable--lgpl configure flag when building tunepimp. This will disable the 
mp3 plugin, which contains GPL code that cannot be used in LGPL mode.
</p>

<& /comp/section, title=>'Interface Reference' &>

<p>
For details on the individual functions mentioned in this page,
please refer to the following pages:

<p>version 0.4.0:</p>
<ul>
<li><a href="/docs/tunepimp/0.4.0/index.html">Online Reference</a>
<li><a href="/docs/tunepimp/0.4.0/tp__c_8h.html">Function Reference</a>
</ul>

<p>version 0.3.0:</p>
<ul>
<li><a href="/docs/tunepimp/0.3.0/index.html">Online Reference</a>
<li><a href="/docs/tunepimp/0.3.0/tp__c_8h.html">Function Reference</a>
</ul>

<p>
Please note that we do no have seperate documentation sections for the perl and python bindings. We have 
made every effort to keep perl and python bindings functioning in a similar manner to the original C
bindings. If you would like to contribute seperate documentation for these bindings, please let us know!
</p>

<& /comp/section, title=>'Overview' &>

<p>
Note: This documenation refers to version 0.4.0.
</p>
<p>
Note: This documenation refers to version 0.4.0. To start using the tunepimp, you need to create a tunepimp_t instance with <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a16">tp_New()</a> passing it the name and version of the application you are writing. Once you are finished with this object, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a18">tp_Delete()</a> to clean up this object. You will need to pass the tunepimp_t object as the first parameter to all functions with a tp_ prefix. If you need to specify an alternate location where the tunepimp plugins can be found, use <a href="file:///home/robert/musicbrainz/tunepimp/docs/html/tp__c_8h.html#a17">tp_NewWithArgs</a> to create the tunepimp object.
</p>

<p>
To start tagging files, add files with <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a43">tp_AddFile()</a> or add whole directories and their subdirectories with <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a44">tp_AddDir()</a>. After files have been added, the metadata read thread will read the metadata from the file and if the file contains MusicBrainz IDs, the file status will be set to eRecognized. If the file does not contain MusicBrainz Ids, it will be set to eUnrecognized. Unlike version 0.3.0 of tunepimp, in version 0.4.0 you need to manually set the status of the file to ePending in order to get tunepimp to generate a TRM id for the file. If the file status is set to ePending, the analyzer starts calculating the TRM acoustic fingerprint for the file. TunePimp will attempt to match the file to a file in MusicBrainz database. During this process, each of the files will be in one of the following states (status):
</p>

<ul>
<li>eMetadataRead - This track is waiting for TunePimp to read the metadata from the file.</li>
<li>ePending - This track is waiting for TunePimp to process it.</li>
<li>eUnrecognized - TunePimp was not able to match this track.</li>
<li>eRecognized - Tunepimp recognized this track.</li>
<li>eTRMLookup - TunePimp is performing a TRM lookup on this track.</li>
<li>eTRMCollision - TunePimp has detected a TRM collision for this track. The user must select which of the matching TRMs to use to finish the recognition process.</li>
<li>eFileLookup - TunePimp is doing a metadata lookup on this file.</li>
<li>eUserSelection - The MB server has returned more than one possible match for the track. The user must select a match to continue the lookup process.</li>
<li>eVerified - The user has verified the matched track and TunePimp is getting ready to save the changes to disk.</li>
<li>eSaved - The file was saved
<li>eDeleted - This track has been deleted from TunePimp, but its reference count has not reached zero yet.</li>
<li>eError - An error occured during the lookup of this track.
</ul>

<p>
To get notified of changes to a track, the TunePimp caller can either choose to install callback functions with 
<a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a34">tp_SetNotifyCallback</a> and
<a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a37">tp_SetStatusCallback</a>, or
decide to poll for changes with <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a36">tp_GetNotification</a> and <a href="http://musicbrainz.org/docs/tunepimp/0.3.0/tp__c_8h.html#a38">tp_GetStatus</a>. If you decide to use the callback methods, you need to ensure that your application is multithread safe and that the callbacks, which could be called at <b>at any time</b>, don't interfere with the rest of your application. If you are unfamiliar with multithreaded programming, choose the polling method for getting notifications and status messages.
</p>

<p>
When your application need to get detailed information about a track from TunePimp, it should call the <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a46">tp_GetTrack()</a> function to get a track_t object. With the track_t object you can call the tr_ functions to examine and/or change the data in a track. Given that TunePimp is heavily multithreaded, <b>you must</b> call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a111">tr_Lock()</a> before you call any of the tr_Get* or tr_Set* functions. Once you are done examining/changing the track, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a112">tr_Unlock()</a>. Make sure that you keep the track locked as little as absolutely necessary, since having a track locked may stall TunePimp and prevent it from doing its job. Once you are done with a track, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a53">tp_ReleaseTrack()</a>. If you made any changes to a track, or changed the status of a track, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a54">tp_Wake()</a> to let TunePimp know that you changed the track.
</p>

<p>
If a track was wrongly identified, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a56">tp_Misidentifed()</a>, which will cause TunePimp to do a metadata only lookup on the track in hopes of finding the correct track. If you need to analyze a track again, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a57">tp_IdentifyAgain()</a> to start the process over. If the user has reviewed all of the tracks that have a status of eRecognized and would like to save them, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a58">tp_WriteTracks()</a>. 
</p>

<p>
During the tagging process TunePimp will automatically collect TRM IDs for each of the tracks that were
matched (if you requested TRM calculations). If any of the TRM IDs need to be submitted to the MusicBrainz server, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a47">tp_GetNumUnsubmitted()</a>. If that returns a value greater than 0, you need to call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a60">tp_SubmitTRMs()</a> to submit the TRMs to the server. Before your call can succeed, make sure to call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a20">tp_SetUserInfo()</a> with the users MusicBrainz login information.
</p>

<p>
For tracks that end up with the eTRMCollision or eUserSelection status, you must present the lookup
results returned from the server to the user. In order to retrieve the results, you must first get the track
with tp_GetTrack(), and then call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a110">tr_GetResults()</a>. Release the track with tp_ReleaseTrack() and then present the results to the user. Once you
are done with the results, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a121">rs_Delete()</a> to delete the results returned from tr_GetResults(). When the user has chosen a set of results and wishes to continue the lookup process for this track, call <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a55">tp_SelectResult()</a>.
</p>

<p>
There are a great number of tp_Set* and tp_Get* functions to influence the behaviour of TunePimp. Most 
of these functions are self explanatory, but the <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a73">tp_SetFileMask()</a> and <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a75">tp_SetVariousFileMask()</a> functions deserve a mention. These two function define the filename convention used by TunePimp to write the finished files to disk. The first call defines the file mask for normal tracks and the second call defines how tracks that are part of various artist albums get written to disk. The idea is that the file mask is a string of characters that will be used as a template for creating filenames. None of the portions of the file mask will be changed -- only the variables that start with % will be replaced by the metadata looked up from the MusicBrainz server.
</p>

<p>
The following variables are available for use in the filemasks:
</p>

<ul>
<li>%artist -- Name of the artist</li>
<li>%abc -- The first character of the artist's sortname (album name in case of a Various Artist album)</li>
<li>%abc2 -- The first two character of the artist's sortname (album name in case of a Various Artist album)</li>
<li>%abc3 -- The first three character of the artist's sortname (album name in case of a Various Artist album)</li>
<li>%sortname -- Sortname of the artist</li>
<li>%track -- Title of the song</li>
<li>%album -- Title of the album</li>
<li>%num -- Track number on the album</li>
<li>%0num -- Track number on the album, zero padded to two places</li>
<li>%format -- The format of the given file e.g. ogg/mp3/wav/flac/ape</li>
<li>%type -- The release type: single, album, remix, etc</li>
<li>%status -- The release status: official, bootleg, promo</li>
<li>%year -- The first release year</li>
<li>%month -- The first release month</li>
<li>%day -- The first release day</li>
<li>%country -- The first release country</li>
</ul>

<p>
So, given this filemask:
</p>

<blockquote>
 %abc2/%sortname/%album/%artist-%album-%0num-%track
</blockquote> 

<p>
a track from The Beatles might be saved to:
</p>

<blockquote>
Be/Beatles, The/Revolver/The Beatles-Revolver-01-Taxman
</blockquote>

<p>
Finally a caveat about using TunePimp on Windows. Due to the screwy nature of DLLs <b>you cannot ever free() or delete a piece of memory that was allocated in a DLL</b>. Doing so will cause erratic behaviour in your application and will lead to random crashes. The only time this becomes an issue is if you are setting data into a track using the <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a102">tr_SetLocalMetadata()</a> or the <a href="http://musicbrainz.org/docs/tunepimp/0.4.0/tp__c_8h.html#a104">tr_SetServerMetadata()</a> function. In either case make sure that you never deallocate any data returned from these functions. Therefore, you should not use any of the md_ metadata functions in windows -- if you need to allocate and free your own metadata_t structures, write your own routines to do so.
</p>

<p>
If you have any questions about the TunePimp library or you are running into trouble using the library, please join the <a href="http://lists.musicbrainz.org/mailman/listinfo/musicbrainz-devel">musicbrainz-devel</a> mailing list and post your questions there.
</p>

<p>
Good luck!
</p>


<& /comp/footer &>

%# vi: set ts=2 sw=2 ft=mason :
<%args>
	$artistid => undef
	$error => undef
</%args>
<%perl>

	$m->comp("/comp/checkloggedin", 1, 1)
		or return;

	$m->comp("/comp/sidebar-notitle", pagetitle => "Add Release");

	unless ($artistid)
	{
		$m->comp("/comp/tablebegin", title => "Add Release");
		$m->out(qq!To add a release, please go to that artist's main page,
					and click on the <b>Add Release</b> link.!);
		$m->comp("/comp/tableend");

		$m->comp("/comp/tablebegin", title => "Search for an Artist");
		$m->comp("/comp/lucenesearch");
		$m->comp("/comp/tableend");

		$m->comp("/comp/movefocus", "TextSearchForm", "search");

		$m->comp("/comp/footer");
		return;
	}

	MusicBrainz::IsNonNegInteger($artistid) && $artistid
		or return $m->comp("/comp/badargs", 0, 1);

	$artistid != &ModDefs::DARTIST_ID
		or return $m->comp(
			"/comp/error",
			"You cannot add a release to the 'Deleted Artist'.",
			0, 1,
		);

	my $mb = $m->comp("/comp/dblogin");

	my $ar = Artist->new($mb->{DBH});
	$ar->SetId($artistid);
	$ar->LoadFromId
		or return $m->comp(
			"/comp/error",
			"Artist #$artistid does not exist",
			0, 1,
		);

</%perl>

	<& /comp/stylemenu &>
	<& /comp/layout/editformbegin, title => "Add Release" &>


%	my $formurl = $artistid == &ModDefs::VARTIST_ID ? "/cdi/menter.html" : "/cdi/enter.html";

		<form method="post" id="AddAlbumForm" action="<% $formurl %>">
			<table class="formstyle">
				<tr>
					<td colspan="2" class="instructions">
						<ul>
							<li>
								You are about to manually add a release to the artist
								<b><& /comp/linkartist, artist => $ar &></b>. Did you know that you can
								<a href="/freedb/freedb.html?search=<% uri_escape($ar->GetName()) %>">import
								releases from the FreeDB database</a>?</li>
							<li>
								Please read the <a href="/style.html">Style Guidelines</a>
								first, then enter the number of tracks on this release:</li>
						</ul>
					</td>
				</tr>


%	if ($error == 1) {
				<tr>
					<td>&nbsp;</td>
					<td class="error">
						<ul><li>Please enter the number of tracks.</li></ul>
				</tr>
%	}
				<tr>
					<td class="label">
						<label for="editalbum_tracks">Number of tracks:</label></td>
					<td class="field">
						<input 	type="text" name="tracks" class="textfield" id="editalbum_tracks"
								size="3" value=""></td>
				</tr>
				<tr>
					<td class="label">&nbsp;</td>
					<td>
						<input type="submit" class="button" value="Next &raquo;"></td>
				</tr>
			</table>

			<input type="hidden" name="noncd" value="1">
			<input type="hidden" name="id" value="">
			<input type="hidden" name="toc" value="">
			<input type="hidden" name="artist" value="<% $artistid %>">
		</form>

<& /comp/movefocus, "AddAlbumForm", "tracks" &>
<& /comp/footer &>

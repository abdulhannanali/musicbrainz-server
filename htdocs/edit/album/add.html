%# vi: set ts=2 sw=2 ft=mason :
<%args>
$artistid => undef
$error => undef
</%args>
<%perl>

$m->comp("/comp/sidebar", title => "Add Album");

unless ($artistid)
{
	</%perl>

	<table width="100%">
		<tr>
			<td align="center">

				<p>
					To add an album, please go to that artist's main page,
					and click on the <b>Add Album</b> link.
				</p>

				<& /comp/tablebegin, title=>"Artist Search" &>
				<& /comp/textsearch &>
				<& /comp/tableend &>

			</td>
		</tr>
	</table>

	<& /comp/movefocus, "TextSearchForm", "search" &>
	<& /comp/footer &>

	<%perl>
	return;
}

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

MusicBrainz::IsNonNegInteger($artistid) && $artistid
	or return $m->comp("/comp/badargs", 0, 1);

$artistid != &ModDefs::DARTIST_ID
	or return $m->comp(
		"/comp/error",
		"You cannot add an alias to this artist.",
		0, 1,
	);

my $mb = $m->comp("/comp/dblogin");

my $ar = Artist->new($mb->{DBH});
$ar->SetId($artistid);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist #$artistid does not exist",
		0, 1,
	);

</%perl>

<& /comp/stylemenu &>

<p>
	You are about to manually add an album to the artist
	<b><% $ar->GetName %></b>. Did you know that you can
	<a href="/freedb/freedb.html?search=<% uri_escape($ar->GetName()) %>">import
	albums from the FreeDB database</a>?
</p>

%	if ($error == 1) {
	<div class="similarartist">
		<span class="warning">Error!</span> Please enter number of tracks.
	</div>
%	}

<form 	method="post" name="AddAlbumForm"
%   if ($artistid == &ModDefs::VARTIST_ID) {
		action="/cdi/menter.html">
%   } else {
		action="/cdi/enter.html">
%   }
		
	<fieldset>
		<legend>Manually Add Album</legend>
		<div class="padleft">
			Please read the <a href="/style.html">style notes</a>
			first, then enter the number of tracks on this album:
		</div>
		<table>
			<tr>
				<td>
					<label for="editalbum_tracks">Number of tracks:</label></td>
				<td>
					<input 	type="text" name="tracks" class="textfield" id="editalbum_tracks"
							size="3" value=""></td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td>
					<input type="submit" class="button" value="Next &raquo;"></td>
			</tr>
		</table>
	</fieldset>

    <input type="hidden" name="noncd" value="1">
    <input type="hidden" name="id" value="">
    <input type="hidden" name="toc" value="">
    <input type="hidden" name="artist" value="<% $artistid %>">
</form>

<& /comp/movefocus, "AddAlbumForm", "tracks" &>
<& /comp/footer &>

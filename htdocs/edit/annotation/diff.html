%# vi: set ts=2 sw=2 ft=mason :
<%args>
$new => undef
$old => undef
</%args>
<%perl>

$m->comp("/comp/checkloggedin", 1, 1)
	or return;

my $mb = $m->comp("/comp/dblogin");

for (\$old, \$new)
{
	my $id = $$_;
	MusicBrainz::IsNonNegInteger($id) && $id
		or return $m->comp("/comp/badargs", 1, 1);

	my $obj = MusicBrainz::Server::Annotation->new($mb->{DBH});
	$obj->SetId($id);
	$obj->LoadFromId
		or return $m->comp("/comp/error", "Annotation #$id not found", 1, 1);
	
	$$_ = $obj;
}

$old->IsForSameObject($new)
	or return $m->comp("/comp/error", "Annotations are not for the same object", 1, 1);

</%perl>
<& /comp/sidebar, title => 'Compare Annotations' &>

<h2>Differences</h2>
<& diff-legend &>
<table class="Annotation">
	<tr class="AnnotationText">
		<td>
			<% MusicBrainz::Server::Markup->diff_as_html($old->GetText, $new->GetText) |n %>
		</td>
	</tr>
</table>

<& /comp/footer &>

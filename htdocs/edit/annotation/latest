%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => undef
$artist => undef
$explain => undef
</%args>
<%perl>

my $mb = $m->comp("/comp/dblogin");

my $annotation = MusicBrainz::Server::Annotation->new($mb->{DBH});

if (defined $artist)
{
	$annotation->SetArtist($artist->GetId);
	$annotation->GetLatestAnnotation
		or $annotation = undef;
}
elsif (defined $album)
{
	$annotation->SetAlbum($album->GetId);
	$annotation->GetLatestAnnotation
		or $annotation = undef;
}
else
{
	return;
}

</%perl>

% if ($annotation) {
  <& /edit/annotation/show, annotation => $annotation, history_link => 1,
	short => 1,
	explain => $explain &>
% } else {
	<p>
%   if ( defined $artist ) {
			This artist doesn't yet have an annotation.&nbsp;
			<a href="/edit/annotation/artist/edit.html?artistid=<% $artist->GetId()
				%>">Add an annotation &gt;&gt;</a>
%   } elsif ( defined $album ) {
			This album doesn't yet have an annotation.&nbsp;
			<a href="/edit/annotation/album/edit.html?albumid=<% $album->GetId()
				%>">Add an annotation &gt;&gt;</a>
%   }
	</p>
% }

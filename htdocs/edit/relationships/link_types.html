%# vi: set ts=4 sw=4 ft=mason :
<%args>
$type => ""
$new => undef
</%args>
<%perl>

$m->comp("/comp/checkloggedin", 1, 1)
	or return;

my @types = split /-/, $type, -1;
MusicBrainz::Server::LinkEntity->ValidateTypes(\@types)
	or return $m->comp("/comp/redirect", "/edit/relationships/link_type_roots.html");

my $mb = $m->comp("/comp/dblogin");
my $root = MusicBrainz::Server::LinkType->new($mb->{DBH}, \@types);
$root = $root->Root
	or die;

my $is_link_mod = UserStuff->IsLinkModerator($session{privs});

</%perl>
<%def .ShowList>
% my ($type, $new, $node, $is_link_mod) = @_;
% my @children = $node->Children;
	<li>
		<div>
%		if ($is_link_mod) {
			<input type="radio" name="id" value="<% $node->GetMBId %>"
				onclick="setCanDelete(this, <% @children ? 'false' : 'true' %>)"
				<% ($new and $new == $node->GetId) ? "checked" : "" %>>
%		}
			<span <% $node->GetModPending ? "class='mp'" : "" %>>
				<b><% $node->GetName %></b> 
%               if ($node->GetName ne 'ROOT') { 
	               <br>
				   <ul>
				   <li>forward: <i><% $node->GetLinkPhrase %></i></li>
   				   <li>reverse: <i><% $node->GetReverseLinkPhrase %></i></li>
   				   <li>description: <% $node->GetDescription %></li>
%                  if ($node->GetAttributes) {
      				   <li>attributes: <% $node->GetAttributes %></li>
%                  }
				   </ul>
%               }
			</span>
		</div>
		<ul class="linktype">
%			$m->comp(".ShowList", $type, $new, $_, $is_link_mod)
%				 for @children;
		</ul>
	</li>
</%def>
<& /comp/sidebar, title => 'Link Types', head => '
<style type="text/css">
ul.linktype { list-style: none; padding-left: 1em }
</style>
'&>

<div class="LinksRow"> [
%	if ($is_link_mod) {
	<a href="/edit/relationships/link_type_roots.html">Edit link types</a>
%	} else {
	<a href="/edit/relationships/link_type_roots.html">View link types</a>
%	}
	| <a href="/edit/relationship/showelements.html">Create a link</a>
] </div>

%if ($is_link_mod) {
<script type="text/javascript">
function setCanDelete(ele, flag) { ele.form.DeleteLink.disabled = !flag; }
</script>

<form method="post" action="do_link_type.html">
%}
<p>Link type: <b><% $type %></b></p>
<ul class="linktype">
<& .ShowList, $type, $new, $root, $is_link_mod &>
</ul>

%if ($is_link_mod) {
<p>
	<input type="hidden" name="type" value="<% $type %>">
	Select link type above, and then:
	<br>
	<input type="submit" name="AddChild" value="Add Child"> below the selected link type
	<br>
	<input type="submit" name="EditLink" value="Edit"> the selected link type
	<br>
	<input type="submit" name="DeleteLink" value="Remove"> the selected link type
</p>

</form>
%}

<& /comp/footer &>

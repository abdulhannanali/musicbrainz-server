<& /comp/sidebar, title=>'Edit Album Attributes', expand=>'moderate' &>

<%perl>

my ($mb, $id, $modpending, $al, $artist, $attr, 
    $attrlist, @attrs, $prev, $index, $url); 

if (!exists $ARGS{id} || $ARGS{id} eq '' ||
    !exists $ARGS{artist} || $ARGS{artist} eq '')
{
    mc_comp("/comp/badargs");
    return undef;
}

$mb = mc_comp("/comp/dblogin");
$id = $ARGS{id};
$artist = $ARGS{artist};
$url = $r->headers_in->{'Referer'};
$url = "/showalbum.html?albumid=$id" if (not defined $url || $url eq '');

$al = Album->new($mb->{DBH});
$al->SetId($id);
$al->LoadFromId();

$prev = "";
@attrs = sort { $a <=> $b} $al->GetAttributes();
$prev = join ',', @attrs;

if (scalar(@attrs) == 0)
{
   @attrs = (Album::ALBUM_ATTR_ALBUM, Album::ALBUM_ATTR_OFFICIAL);
}

$modpending = $al->GetAttributeModPending();
$attrlist = $al->GetAttributeList();

</%perl>

% if (!defined $session{user} || $session{user} eq '') {
    You must be logged in to edit the database.<p>
    <& /comp/tablebegin, title=>'Login' &>
    <& /comp/loginbox &>
    <& /comp/tableend &>
% } else {

% if ($modpending) {
    <& /comp/modpending &>
% } 

    <p>
    Select the appropriate album attributes below and then 
    click on Submit.<p>

    Album <b><% $al->GetName() %></b>:<br>

    <FORM METHOD="POST" ACTION="/bare/enter_kv_mod.html" 
          NAME="EditAlbumAttrsForm"
          ENCTYPE="application/x-www-form-urlencoded">  
    <table width="100%">
      <tr>
        <td>
        <blockquote>
        <table width="75%">
        <tr><td colspan=\"3\"><b>Release type:</b></td></tr>

        <%perl>
        for(Album::ALBUM_ATTR_SECTION_TYPE_START..Album::ALBUM_ATTR_SECTION_TYPE_END)
        {
            mc_out("<tr><td valign=\"top\" NOWRAP>");
            mc_out("<input type=\"radio\" name=\"value1\" value=\"$_\"");
            if (scalar(@attrs) > 0 && $attrs[0] == $_)
            {
                mc_out(" CHECKED");
                shift @attrs;
            }
            mc_out("></td><td valign=\"top\">$attrlist->{$_}->[0]</td>");
            mc_out("<td valign=\"top\">$attrlist->{$_}->[1]</td></tr>");
        }
        mc_out("<input type=\"hidden\" name=\"key1\"");
        mc_out(" value=\"AttrType\">");
        mc_out("<tr><td colspan=\"3\"><br><b>Release status:</b></td></tr>");
        for(Album::ALBUM_ATTR_SECTION_STATUS_START..Album::ALBUM_ATTR_SECTION_STATUS_END)
        {
            mc_out("<tr><td valign=\"top\" NOWRAP>");
            mc_out("<input type=\"radio\" name=\"value2\" value=\"$_\"");
            if (scalar(@attrs) > 0 && $attrs[0] == $_)
            {
                mc_out(" CHECKED");
                shift @attrs;
            }
            mc_out("></td><td valign=\"top\">$attrlist->{$_}->[0]</td>");
            mc_out("<td valign=\"top\">$attrlist->{$_}->[1]</td></tr>");
        }
        mc_out("<input type=\"hidden\" name=\"key2\"");
        mc_out(" value=\"AttrStatus\">");
        </%perl>
        </table> 
        </blockquote>
        <p>
        </td>
      </tr>
      <tr>
        <td>
        <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
        </td>
      </tr>
    </table>
    <input type="hidden" name="key0" value="AlbumName">
    <input type="hidden" name="value0" value="<% $al->GetName() %>">
    <input type="hidden" name="artist" value="<% $artist %>">
    <input type="hidden" name="type" 
           value="<% ModDefs::MOD_EDIT_ALBUMATTRS %>">
    <input type="hidden" name="prev" value="<% $prev  %>">
    <input type="hidden" name="table" value="Album">
    <input type="hidden" name="column" value="Attributes">
    <input type="hidden" name="id" value="<% $id %>">
    <input type="hidden" name="url" value="<% $url %>">
    </form>
      
% }
% $mb->Logout();
<& /comp/footer &>

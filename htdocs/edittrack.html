<& /comp/sidebar, title=>'Edit Track Name', expand=>'moderate' &>

<%perl>

my ($mb, $id, $trackname, $tr);
my ($seq_id, $tracknum, $album, $artist); 

if (!exists $ARGS{album} || $ARGS{album} eq '' ||
    !exists $ARGS{artist} || $ARGS{artist} eq '' ||
    !exists $ARGS{id} || $ARGS{id} eq '')
{
    mc_comp("/comp/badargs");
    return undef;
}

$mb = new MusicBrainz;
$mb->Login();
$tr = Track->new($mb->{DBH});

$id = $ARGS{id};
$album = $ARGS{album};
$artist = $ARGS{artist};

$tr->SetId($id);
$tr->SetAlbum($album);
$tr->LoadFromId();

$trackname = $tr->GetName();
$tracknum = $tr->GetSequence();
$seq_id = $tr->GetSequenceId();

</%perl>

% if (!defined $session{user} || $session{user} eq '') {
    You must be logged in to edit the database.<p>
    <& /comp/tablebegin, title=>'Login' &>
    <& /comp/loginbox &>
    <& /comp/tableend &>
% } else {

    <& /comp/tablebegin, gattrs=>"width=\"100%\"",
       title=>'Edit Track Name' &>

    <FORM METHOD="POST" ACTION="/bare/enter_mod.html" NAME="EditTrackForm"
          ENCTYPE="application/x-www-form-urlencoded">  
    <table width="100%">
      <tr>
        <td>
        Current Name:
        </td>
        <td>
        <% $trackname  %>
        </td>
      </tr>
      <tr>
        <td>
        New Name:
        </td>
        <td>
        <INPUT TYPE="text" NAME="new0" SIZE=25 value="<% $trackname %>"> 
        </td>
      </tr>
      <tr>
        <td>
        Current Track Number:
        </td>
        <td>
        <% $tracknum %>
        </td>
      </tr>
      <tr>
        <td>
        New Track Number:
        </td>
        <td>
        <INPUT TYPE="text" NAME="new1" SIZE=25 value="<% $tracknum %>"> 
        </td>
      <tr>
        <td colspan=2>
        <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
        </td>
      </tr>
    </table>
    <input type="hidden" name="artist0" value="<% $artist %>">
    <input type="hidden" name="artist1" value="<% $artist %>">
    <input type="hidden" name="type0"
           value="<% ModDefs::MOD_EDIT_TRACKNAME %>">
    <input type="hidden" name="type1"
           value="<% ModDefs::MOD_EDIT_TRACKNUM %>">
    <input type="hidden" name="prev0" value="<% $trackname %>">
    <input type="hidden" name="prev1" value="<% $tracknum %>">
    <input type="hidden" name="table0" value="Track">
    <input type="hidden" name="table1" value="AlbumJoin">
    <input type="hidden" name="column0" value="Name">
    <input type="hidden" name="column1" value="Sequence">
    <input type="hidden" name="id0" value="<% $id %>">
    <input type="hidden" name="id1" value="<% $seq_id %>">
    <input type="hidden" 
           name="url" value="/showalbum.html?albumid=<% $album %>">
    </form>
      
    <& /comp/tableend &>

    <& /comp/stylenotes &>
% }
% $mb->Logout();

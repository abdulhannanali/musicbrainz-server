%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

my $mb = $m->comp("/comp/dblogin");
my $ar = Artist->new($mb->{DBH});
$ar->SetId(&ModDefs::VARTIST_ID);
$ar->LoadFromId or return;

$session{"freedb_artistid"} = $ar->GetId;
$session{"freedb_artist"} = $ar->GetName;
$session{"freedb_sortname"} = undef;

# TODO guess split here?

$m->comp(
	"show-similar-albums",
	$ar,
	"/freedb/mac-edittrack.html?t=0&auto=1",
) and return;

return $m->comp(
	"/comp/redirect",
	"/freedb/mac-edittrack.html?t=0&auto=1",
);

</%perl>

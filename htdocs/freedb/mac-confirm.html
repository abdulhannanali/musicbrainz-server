%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

my $ar = Artist->new(undef);
$ar->SetId($session{"freedb_artistid"});
$ar->SetName($session{'freedb_artist'});
$ar->SetSortName($session{'freedb_sortname'});

my $t = $session{"freedb_tracks"};

</%perl>
<& /comp/sidebar, title => "FreeDB Import - Confirm Import" &>

<p>
	You are about to add the following release to MusicBrainz:
</p>

	<table>
		<col>
		<col style="width: 0.5em">
		<col style="width: 20em">
		<tr>
			<td>Artist:</td>
			<td rowspan="<% $t+4 %>">
			<td>
				<a href="/showartist.html?artistid=<% &ModDefs::VARTIST_ID %>"
					>Various Artists</a>
			</td>
			<td rowspan="<% $t+4 %>">
			<td></td>
		</tr>
		<tr>
			<td>Album:</td>
			<td><% $session{'freedb_album'} %></td>
			<td></td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<th></th>
			<th>Track Name</th>
			<th>Artist Name</th>
			<th></th>
		</tr>
% for my $i (0 .. $t-1) {
		<tr>
			<td>Track <% $i+1 %>:</td>
			<td><% $session{"freedb_track$i"} %></td>
			<td>
% if (my $id = $session{"freedb_artistid$i"}) {
				<a href="/showartist.html?artistid=<% $id %>"
					><% $session{"freedb_artistname$i"} %></a>
% } else {
					<% $session{"freedb_artistname$i"} %>
% if ($session{"freedb_artistname$i"} ne $session{"freedb_sortname$i"}) {
					(<% $session{"freedb_sortname$i"} %>)
% }
% }
			</td>
		</tr>
% }
	</table>

<table>
	<tr>
		<td style="padding: 1em">
			<form method="post" action="/freedb/mac-edittracks.html">
				<p>
					<input type="submit" value="Keep Editing">
				</p>
			</form>
		</td>
		<td style="padding: 1em">
			<form method="post" action="/freedb/cancel.html">
				<p>
					<input type="submit" value="Abandon Import">
				</p>
			</form>
		</td>
		<td style="padding: 1em">
			<form method="post" action="/freedb/final.html">
				<p>
					<input type="submit" value="Continue">
				</p>
			</form>
		</td>
	</tr>
</table>

<& /comp/footer &>

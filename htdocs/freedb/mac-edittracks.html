%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

# Update track names

$session{"freedb_album"} = $ARGS{"album"}
	if exists $ARGS{"album"};

for my $i (0 .. $session{"freedb_tracks"}-1)
{
	$session{"freedb_track$i"} = $ARGS{"track$i"}
		if exists $ARGS{"track$i"};
}

return $m->comp("/comp/redirect", "/freedb/mac-confirm.html")
	if $ARGS{"continue"};

my $t = $session{"freedb_tracks"};

</%perl>
<& /comp/sidebar, title => "FreeDB Import: Edit Album Name" &>

<& /comp/stylemenu &>

<form method="post" action="/freedb/mac-edittracks.html">

	<& /comp/autofixmenu &>

	<fieldset>
		<legend>Edit Album Name</legend>
		<table>
			<tr>
				<td><label for="fdbmac_album">Album:</label></td>
				<td><input type="text" name="album" class="textfield"
					id="fdbmac_album"
					onFocus="myOnFocus(this)" onBlur="myOnBlur(this)"
					style="width: 100%"
					size="50"
					value="<% $session{'freedb_album'} %>">
				</td>
				<td><script type="text/javascript">
					<!--
						af_writeButton(AF_BTN_ALBUM, 'album');
					-->
					</script></td>
			</tr>
			<tr>
				<td><label>Artist:</label></td>
				<td><a href="/showartist.html?artistid=<% &ModDefs::VARTIST_ID %>">Various Artists</a> [ <a href="/freedb/select-artist.html">Change</a> ]</td>
			</tr>
			<tr>
				<td nowrap><label>FreeDB Artist:</label></td>
				<td><% $session{"freedb_default_artist"} %></td>
			</tr>
		</table>
	</fieldset>

	<fieldset>
		<legend>Review Artist and Track Names</legend>
		<table border="0" cellspacing="0" cellpadding="2">
			<tr>
				<td><b>#</td>
				<td>&nbsp;</td>
				<td><b>Artist Name:</td>
				<td>&nbsp;</td>
				<td><b>Track Name:</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
			</tr>
% for my $i (0 .. $t-1) {
%# TODO shaded rows
			<tr bgcolor="<% ($i%2) ? '#ffe1b7' : '#ffffff' %>">
				<td valign="top"><b><% $i+1 %></td>
				<td>&nbsp;</td>
				<td valign="top">
% if (my $id = $session{"freedb_artistid$i"}) {
					<a href="/showartist.html?artistid=<% $id %>"
						><% $session{"freedb_artistname$i"} %></a>
% } else {
						<% $session{"freedb_artistname$i"} %>
% if ($session{"freedb_artistname$i"} ne $session{"freedb_sortname$i"}) {
						(<% $session{"freedb_sortname$i"} %>)
% }
% }
				</td>
				<td>&nbsp;</td>
				<td valign="top"><% $session{"freedb_track$i"} %></td>
				<td>&nbsp;</td>
				<td valign="top" nowrap align="center">[ <a href="/freedb/mac-edittrack.html?t=<% $i %>">Change</a> ]</td>
			</tr>
% }

			<tr>
				<td>&nbsp;</td>
				<td colspan="3" class="padtop">
					<input type="submit" class="button" value="Continue">
					<input type="hidden" name="continue" value="1">
				</td>
		</table>   
	</fieldset>
</form>

<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

# Update track names

$session{"freedb_album"} = $ARGS{"album"}
	if exists $ARGS{"album"};

for my $i (0 .. $session{"freedb_tracks"}-1)
{
	$session{"freedb_track$i"} = $ARGS{"track$i"}
		if exists $ARGS{"track$i"};
}

return $m->comp("/comp/redirect", "/freedb/mac-confirm.html")
	if $ARGS{"continue"};

my $t = $session{"freedb_tracks"};

</%perl>
<& /comp/sidebar, title => "FreeDB Import - Edit Tracks & Artists" &>

<script type="text/javascript" src="/scripts/guess.js"></script>

<form method="post" action="/freedb/mac-edittracks.html">

	<table>
		<col>
		<col style="width: 0.5em">
		<col style="width: 15em">
		<col style="width: 0.5em">
		<col style="width: 15em">
		<col style="width: 0.5em">
		<col style="width: 6em">
		<tr>
			<td>Artist:</td>
			<td rowspan="<% $t+5 %>">
			<td>
				<a href="/showartist.html?artistid=<% &ModDefs::VARTIST_ID %>"
					>Various Artists</a>
			</td>
			<td rowspan="<% $t+5 %>">
			<td></td>
			<td rowspan="<% $t+5 %>">
			<td nowrap align="center">[ <a href="/freedb/select-artist.html">Change</a> ]</td>
		</tr>
		<tr>
			<td nowrap>FreeDB Artist:</td>
			<td><% $session{"freedb_default_artist"} %></td>
		</tr>
		<tr>
			<td>Album:</td>
			<td><input type="text" name="album" style="width: 100%"
				value="<% $session{'freedb_album'} %>"></td>
			<td></td>
			<td align="center"><input type="button" value="Guess Case"
				onclick="this.form.album.value = GuessCase(this.form.album.value)"
				></td>
		</tr>
		<tr><td>&nbsp;</td></tr>
		<tr>
			<th></th>
			<th>Track Name</th>
			<th>Artist Name</th>
			<th></th>
		</tr>
% for my $i (0 .. $t-1) {
%# TODO shaded rows
		<tr bgcolor="<% ($i%2) ? '#ffe1b7' : '#ffffff' %>">
			<td valign="top" nowrap>Track <% $i+1 %>:</td>
			<td valign="top"><% $session{"freedb_track$i"} %></td>
			<td valign="top">
% if (my $id = $session{"freedb_artistid$i"}) {
				<a href="/showartist.html?artistid=<% $id %>"
					><% $session{"freedb_artistname$i"} %></a>
% } else {
					<% $session{"freedb_artistname$i"} %>
% if ($session{"freedb_artistname$i"} ne $session{"freedb_sortname$i"}) {
					(<% $session{"freedb_sortname$i"} %>)
% }
% }
			</td>
			<td valign="top" nowrap align="center">[ <a href="/freedb/mac-edittrack.html?t=<% $i %>">Change</a> ]</td>
		</tr>
% }
	</table>

	<p style="text-align: center">
		<input type="submit" value="Continue">
		<input type="hidden" name="continue" value="1">
	</p>
</form>

<& /comp/footer &>

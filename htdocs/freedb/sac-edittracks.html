%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

# Update track names

$session{"freedb_album"} = $ARGS{"album"}
	if exists $ARGS{"album"};

for my $i (0 .. $session{"freedb_tracks"}-1)
{
	$session{"freedb_track$i"} = $ARGS{"track$i"}
		if exists $ARGS{"track$i"};
}

return $m->comp("/comp/redirect", "/freedb/sac-confirm.html")
	if $ARGS{"continue"};

my $ar = Artist->new(undef);

$ar->SetId($session{"freedb_artistid"});
$ar->SetName($session{'freedb_artist'});
$ar->SetSortName($session{'freedb_sortname'});

my $t = $session{"freedb_tracks"};

</%perl>
<& /comp/sidebar, title => "FreeDB Import: Edit Album and Track Names" &>

<& /comp/stylemenu &>

<form method="post" action="/freedb/sac-edittracks.html">

	<& /comp/autofixmenu &>

	<fieldset>
		<legend>Edit Album and Track Names</legend>

		<table>
			<tr>
				<td>Artist:</td>
				<td>
% if ($ar->GetId) {
				<a href="/showartist.html?artistid=<% $ar->GetId %>"><% $ar->GetName %></a>
% } else {
					<% $ar->GetName %>
					(<% $ar->GetSortName %>)
% }
				</td>
				<td rowspan="<% $t+4 %>">
				<td nowrap align="center">[ <a href="/freedb/select-macsac.html">Change</a> ]</td>
			</tr>
			<tr>
				<td><label for="fdbsac_album">Album:</label></td>
				<td><input 	type="text" name="album" class="textfield"
							id="fdbsac_album"
							size="50"
							value="<% $session{'freedb_album'} %>"></td>
				<td>
					<& /comp/form/jsbutton, id=>"BTN_ALBUM::album" &></td>
			</tr>
% for my $i (0 .. $t-1) {
			<tr>
				<td><label for="fdbsac_track<% $i %>"><% $i+1 %>:</label></td>
				<td><input 	type="text" name="track<% $i %>" class="textfield"
							id="fdbsac_track<% $i %>"
							size="50"
							value="<% $session{"freedb_track$i"} %>"></td>
				<td>
					<& /comp/form/jsbutton, id=>"BTN_TRACK::track".$i &></td>
			</tr>
% }
			<tr>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td><& /comp/form/jsbutton, id=>"BTN_ALL" &></td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td colspan="2">
					<input type="submit" class="button" value="Continue">
					<input type="hidden" name="continue" value="1"></td>
		</table>
	</fieldset>
</form>

<& /comp/footer &>

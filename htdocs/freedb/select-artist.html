%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

if (my $id = $ARGS{'selectedartist'})
{
	return $m->comp(
		"/comp/redirect",
		"/freedb/mac-check-similar.html",
	) if $id == &ModDefs::VARTIST_ID;

	my $mb = $m->comp("/comp/dblogin");
	my $ar = Artist->new($mb->{DBH});
	$ar->SetId($id);
	$ar->LoadFromId
		or return;
	
	$session{"freedb_artistid"} = $ar->GetId;
	$session{"freedb_artist"} = $ar->GetName;
	$session{"freedb_sortname"} = undef;

	return $m->comp(
		"/comp/redirect",
		"/freedb/sac-check-similar.html",
	);
}

if (defined(my $name = $ARGS{'newartistname'}))
{
	$session{"freedb_artistid"} = undef;
	$session{"freedb_artist"} = $name;
	$session{"freedb_sortname"} = $ARGS{'newartistsortname'};

	return $m->comp(
		"/comp/redirect",
		"/freedb/sac-edittracks.html",
	);
}

</%perl>
<& /comp/sidebar, title => "FreeDB Import - Select Artist" &>

<h2>Select Artist</h2>

<p>
	Please search for this release's artist:
</p>

<& /comp/artistfilter,
	search => $ARGS{'search'},
	allowcreate => 1,
	url => "/freedb/select-artist.html",
	&>

<& /comp/footer &>

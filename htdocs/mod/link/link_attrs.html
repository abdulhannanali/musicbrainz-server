%# vi: set ts=4 sw=4 ft=mason :
<%args>
$new => undef
</%args>
<%perl>

$m->comp("/comp/checkloggedin", 1, 1)
	or return;

my $mb = $m->comp("/comp/dblogin");
my $root = MusicBrainz::Server::LinkAttr->new($mb->{DBH});
$root = $root->Root
	or die;

my $is_link_mod = UserStuff->IsLinkModerator($session{privs});

</%perl>
<%def .ShowList>
% my ($new, $node, $is_link_mod) = @_;
	<li>
		<div>
%		if ($is_link_mod) {
			<input type="radio" name="id" value="<% $node->GetMBId %>"
				<% ($new and $new == $node->GetId) ? "checked" : "" %>>
%		}
			<span <% $node->GetModPending ? "class='mp'" : "" %>>
				<b><% $node->GetName %></b>
%               if ($node->GetName ne 'ROOT') { 
	               (<% $node->GetDescription %>)
%               }
			</span>
		</div>
		<ul class="linktype">
%			$m->comp(".ShowList", $new, $_, $is_link_mod)
%				 for $node->Children;
		</ul>
	</li>
</%def>
<& /comp/sidebar, title => 'Attribute Types', head => '
<style type="text/css">
ul.linktype { list-style: none; padding-left: 1em }
</style>
'&>

<div class="LinksRow"> [
%	if ($is_link_mod) {
	<a href="/mod/link/link_type_roots.html">Edit link types</a>
%	} else {
	<a href="/mod/link/link_type_roots.html">View link types</a>
%	}
] </div>

%if ($is_link_mod) {
<p>
Note: The top level attribute names are used as the keys for link types, thus the names
should be a single all-lowercase word.
</p>

<form method="post" action="do_link_attr.html">
%}
<ul class="linktype">
<& .ShowList, $new, $root, $is_link_mod &>
</ul>

%if ($is_link_mod) {
<p>
	Select link type above, and then:
	<br>
	<input type="submit" name="AddChild" value="Add Child"> below the selected link type
	<br>
	<input type="submit" name="EditLink" value="Edit"> the selected link type
	<br>
	<input type="submit" name="DeleteLink" value="Remove"> the selected link type
</p>

</form>
%}

<& /comp/footer &>

<& /comp/sidebar, title=>'Confirm Remove Albums', expand=>'moderate' &>

<%perl>

my ($mb, $id, $ar, $artist); 

$mb = mc_comp("/comp/dblogin");

if (!defined $session{user} || $session{user} eq '') {
</%perl>
    You must be logged in to edit the database.<p>
    <& /comp/tablebegin, title=>'Login' &>
    <& /comp/loginbox &>
    <& /comp/tableend &>
<%perl>
} 
else 
{
    my ($i, $al, @objs);

    for($i = 0;; $i++)
    {
       if (exists $ARGS{"key$i"} && $ARGS{"key$i"} =~ m/^AlbumId/)
       {
           $al = Album->new($mb->{DBH});
           $al->SetId($ARGS{"value$i"});
           push @objs, $al if (defined $al->LoadFromId())
       }
       else
       {
           last;
       }
    }

    </%perl>
    Please review the list of albums to be deleted, and then
    confirm this moderation at the bottom of this page.<p>
    All of the albums below this one will be removed:<p>
    <%perl>

    $ar = Artist->new($mb->{DBH});
    foreach $al (@objs)
    {
       if ($ar->GetId() != $al->GetArtist())
       {
           $ar->SetId($al->GetArtist());
           if (not defined $ar->LoadFromId())
           {
              mc_out("Could not load artist " . $ar->GetId() . ".");
              next;
           }
           mc_comp("/comp/artisttitle", artist=>$ar, nomod=>1);
       }
       mc_comp("/comp/album", album=>$al, artist=>$ar, nomod=>1);
    }
}
</%perl>

<& /comp/tablebegin, title=>"Confirm Album Removal" &>

<FORM METHOD="POST" ACTION="/bare/enter_kv_mod.html" NAME="RemoveConfirm"
      ENCTYPE="application/x-www-form-urlencoded">  

<table width="100%">
  <tr>
    <td colspan="2">
    Are you sure you want to remove the albums above?
    </td>
  </tr>
  <tr>
    <td>
    &nbsp;
    </td>
    <td>
    <INPUT TYPE="radio" NAME="confirm0" SIZE=25 value="yes"> Yes
    </td>
  </tr>
  <tr>
    <td>
    &nbsp;
    </td>
    <td>
    <INPUT TYPE="radio" NAME="confirm0" SIZE=25 value="no" CHECKED> No
    </td>
  </tr>
  <tr>
    <td colspan=2>
    <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
    </td>
  </tr>
</table>

% my $key;
% foreach $key (keys %ARGS) {
    <input type="hidden" name="<% $key %>" value="<% $ARGS{$key} %>">
% }

</form>
<& /comp/tableend &>

% $mb->Logout();

<& /comp/footer &>

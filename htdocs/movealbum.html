%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => ""
</%args>
<& /comp/sidebar, title=>'Move Album' &>
<%perl>

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

MusicBrainz::IsNonNegInteger($album) && $album
	or return $m->comp("/comp/badargs", 0, 1);

my $mb = $m->comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
$al->SetId($album);
$al->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Album #$album not found",
		0, 1,
	);

# TODO reject if artist == VARTIST_ID ?
#$al->GetArtist == ModDefs::VARTIST_ID
#	and return $m->comp(
#		"/comp/error",
#		"You can't move this album.",
#		0, 1,
#	);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($al->GetArtist);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist not found",
		0, 1,
	);

</%perl>

<& /comp/stylemenu &>

<h2>Move Album '<% $al->GetName %>'</h2>

% if ($al->GetModPending) {
    <& /comp/modpending &>
% }

<p>
    Enter the artist <span class="bold">sortname</span> to
		whom you'd like to move album
		<a href="/showalbum.html?albumid=<% $al->GetId %>"
			><% $al->GetName %></a>:
</p>

<form method="post" action="/artistfilter.html" name="MoveArtistForm"
	enctype="application/x-www-form-urlencoded">

    <table>
      <tr>
        <td>
					Current Artist Sortname:
        </td>
        <td>
					<a href="/showartist.html?artistid=<% $ar->GetId %>"
						><% $ar->GetSortName  %></a>
        </td>
      </tr>
      <tr>
        <td>
					New Artist Sortname:
        </td>
        <td>
					<input type="text" name="new0" size="40" value="<% $ar->GetSortName %>">
        </td>
      </tr>
      <tr>
        <td colspan=2>
					<input type="submit" value="Next &gt;&gt;">
        </td>
      </tr>
    </table>

    <input type="hidden" name="mode" value="move">
		<input type="hidden" name="album" value="<% $al->GetName %>">
		<input type="hidden" name="artist0" value="<% $ar->GetId %>">
    <input type="hidden" name="type0" value="<% ModDefs::MOD_MOVE_ALBUM %>">
		<input type="hidden" name="prev0" value="<% $ar->GetName %>">
    <input type="hidden" name="table0" value="Album">
    <input type="hidden" name="column0" value="Artist">
		<input type="hidden" name="id0" value="<% $al->GetId %>">
		<input type="hidden" name="url" value="/showalbum.html?albumid=<% $al->GetId %>">
		<input type="hidden" name="artistfilter_dontshow" value="<% $ar->GetId %>">
</form>

<& /comp/movefocus, "MoveArtistForm", "new0" &>
<& /comp/footer &>

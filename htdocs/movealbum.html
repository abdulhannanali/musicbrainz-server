%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => ""
$artist => ""
</%args>
<& /comp/sidebar, title=>'Move Album' &>
<%perl>

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

($album || "") =~ /\A(\d{1,20})\z/
	or return $m->comp("/comp/badargs", 0, 1);

($artist || "") =~ /\A(\d{1,20})\z/
	or return $m->comp("/comp/badargs", 0, 1);

$artist == ModDefs::DARTIST_ID
	and return $m->comp("/comp/badargs", 0, 1);

my $mb = mc_comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
$al->SetId($album);
$al->LoadFromId($album)
	or return $m->comp("/comp/badargs", 0, 1);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($artist);
$ar->LoadFromId()
	or return $m->comp("/comp/badargs", 0, 1);

my $albumname = $al->GetName();
my $modpending = $al->GetModPending();
my $artistname = $ar->GetName();
my $sortname = $ar->GetSortName();

</%perl>

    <& /comp/stylemenu &>

    <& /comp/tablebegin, gattrs=>"width=\"100%\"",
       title=>"Move Album '$albumname'" &>

% if ($modpending) {
    <& /comp/modpending &>
% } 

    Enter the artist <span class="bold">sortname</span> to 
    whom you'd like to move album '<% $albumname %>':

    <FORM METHOD="POST" ACTION="/artistfilter.html" NAME="MoveArtistForm"
          ENCTYPE="application/x-www-form-urlencoded">  
    <table>
      <tr>
        <td>
        Current Artist Sortname:
        </td>
        <td>
        <% $sortname  %>
        </td>
      </tr>
      <tr>
        <td>
        New Artist Sortname:
        </td>
        <td>
        <INPUT TYPE="text" NAME="new0" SIZE=25 value="<% $sortname %>"> 
        </td>
      </tr>
      <tr>
        <td colspan=2>
        <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
        </td>
      </tr>
    </table>
    <input type="hidden" name="mode" value="move">
    <input type="hidden" name="album" value="<% $albumname %>">
    <input type="hidden" name="artist0" value="<% $artist %>">
    <input type="hidden" name="type0" value="<% ModDefs::MOD_MOVE_ALBUM %>">
    <input type="hidden" name="prev0" value="<% $artistname  %>">
    <input type="hidden" name="table0" value="Album">
    <input type="hidden" name="column0" value="Artist">
    <input type="hidden" name="id0" value="<% $album %>">
    <input type="hidden" name="url" value="/showalbum.html?albumid=<% $album %>">
    <input type="hidden" name="artistfilter_dontshow" value="<% $artist %>">
    </form>
      
    <& /comp/tableend &>

% $mb->Logout();

<& /comp/movefocus, "MoveArtistForm", "new0" &>
<& /comp/footer &>

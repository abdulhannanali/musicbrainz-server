%# vi: set ts=2 sw=2 ft=mason :
<& /comp/sidebar, title => 'January 17th, 2004: Server Updates', head => '
<style type="text/css">
ul, ol { padding-left: 0.7em }
li { margin-top: 0.5em; margin-bottom: 0.5em }
</style>
' &>

<h2>Changes mainly of interest to MusicBrainz Users</h2>

<h3>Inline Moderation</h3>

<p>(This feature by Robert Kaye)</p>

<p>
	In an effort to reduce the voting backlog, the system now shows you
	one vote at a time whenever you're on an artist, album or track page.&nbsp;
	The moderation chosen is, in order of preference: for this artist; for one of
	your subscribed artists; for an artist related to this artist; or anything
	at random.&nbsp; When you click one of the three voting buttons (yes, no,
	abs) then the voting panel reloads to show something else to vote on.&nbsp;
	The rest of the page remains unchanged.
</p>

<h3>Faster Voting Pages</h3>

<p>
	The moderation database tables have been reorganised behind the
	scenes.&nbsp; The result of this is that
	<a href="/mod/search/pre/new.html">the voting pages</a> (in particular)
	should be much faster.&nbsp; See "Moderation Table Restructuring" below
	for more technical details of what's actually changed.
</p>

<h3>Reveal My E-Mail Address</h3>

<p>
	When sending an e-mail to another moderator, it's now possible
	(as long as you've told MusicBrainz your e-mail address) to choose
	to reveal your e-mail address to the other party.&nbsp; Doing so makes it
	much easier for them to reply to you.&nbsp; The default setting is
	controlled by a new <a href="/prefs.html">preference</a>, which in turn
	defaults to "off" (i.e. don't reveal my address).&nbsp;
	<a <& /comp/auto-popup-link,
		url => "/products/server/docs/20040103-1.html",
		&>>Read the help</a> for more information.
</p>

<h3>Other Changes</h3>

<ul>
	<li>
		When searching for moderations, you can now search for mods
		on artists <em>related to</em> some given artist.
	</li>
	<li>
		Tied votes are now passed (previously there had to be a clear majority to
		win).
	</li>
	<li>
		When sending an e-mail to another moderator, sometimes extra quotes were
		added to the subject line (so instead of the subject being <em>Hi
		there</em> for example, it would be <em>"Hi there"</em>).&nbsp; These
		stray quotes have now been removed.
	</li>
	<li>
		The HTML generated by a "Link with Icon" (for an artist, album or track
		link) now ensures that the icon will be on the same line as the text which
		follows.
	</li>
	<li>
		For "Edit Artist Alias", "Edit Artist Sortname", "Edit Track Number" and
		"Merge Artist" moderations, if the record being changed is missing then close
		the moderation with a "Failed prerequisite" status instead of "Internal
		error".
	</li>
	<li>
		The "Show TRM" page now sorts the matched tracks by artist and album, and
		only shows each album once (even if more than one track on that album
		matches the TRM).&nbsp;
		<a href="/showtrm.html?trm=b10e89c8-a1e0-4bf5-9049-dc9f69bda7fa"
			>Example</a>.
	</li>
</ul>

<h2>New and Changed Documentation</h2>

<ul>
	<li>
		<a <& /comp/auto-popup-link,
			url => "/products/server/docs/20040103-1.html",
			&>>the "Reveal my e-mail address" option</a>
	</li>
</ul>

<h2>Changes mainly of interest to MusicBrainz Programmers</h2>

<p>
	If you download and import the MusicBrainz database (including the
	moderation tables) from time to time, read "Moderation Table Restructuring"
	(below).
</p>

<h2>Changes mainly of interest to MusicBrainz Server Programmers</h2>

<h3>Mason</h3>

<p>(This feature by <a href="mailto&#x3a;duncf&#x0040;rogers.com">Duncan Findlay</a>)</p>

<p>
	The MusicBrainz server now uses <a href="http://www.masonhq.com/">Mason</a>
	1.25 (previously we used 1.05).&nbsp; Mason underwent something of a
	redesign following 1.05, so making it past this "hurdle" should help us in
	the future.
</p>
	
<h3>Moderation Table Restructuring</h3>

<p>
	The moderation-related tables have been reorganised, so as to speed up the
	voting pages.&nbsp; Almost all queries against the moderation tables deal
	with open moderations, but Postgres seemed to be having trouble optimising
	those queries (despite an index on moderation.status).&nbsp; Well, maybe we
	missed something obvious, maybe not.&nbsp; Anyway, what we've done is to
	split the three tables (moderation, moderationnote and votes) into six
	(moderation_open, moderation_note_open, vote_open;
	and
	moderation_closed, moderation_note_closed, vote_closed).&nbsp; So most
	queries can now just refer to <em>moderation_open</em>, which is a MUCH smaller table
	than <em>moderation</em> used to be.
</p>

<p>
	As a side-effect, the data for closed moderations is now dumped into a
	separate file (<em>mbdump-closedmoderation.tar.bz2</em>), making the
	<em>mbdump-moderation.tar.bz2</em> file much smaller.&nbsp; Hence, if you
	want to download open moderation data but have no need for closed
	moderations, life has just become a little easier for you.
</p>

<h3>Other Changes</h3>

<p>
	The <a href="http://cvs.musicbrainz.org/cvs/mb_server/admin/sql/Attic/CreateTables-mysql.sql">CreateTables-mysql.sql</a>
	script has been removed.&nbsp; It was generally poorly maintained, and
	hardly ever tested, and the costs of maintaining it outweighed the
	benefits.&nbsp; If you want to create a MusicBrainz database in MySQL,
	start with the <a href="http://cvs.musicbrainz.org/cvs/mb_server/admin/sql/CreateTables.sql">CreateTables.sql</a>
	script.
</p>

<p>
	<a href="http://cvs.musicbrainz.org/cvs/mb_server/admin/RDFDump.pl">
	RDFDump.pl</a> has been fixed. RDF dumps now contain all artists
	we have in the database.
</p>

<h2>Bugs and RFEs Closed</h2>

<& buglist.inc,
	'849560 	use "real" From: when sending email to moderators',
	"869080 	suggestion report for subscribed",
	"870528 	View all songs by an artist",
	&>

Dave Evans

<& /comp/footer &>

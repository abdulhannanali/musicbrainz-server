<& /comp/sidebar, title=>'Remove Diskid', expand=>'moderate' &>

<%perl>

my ($mb, $albumname, $al, $di);
my ($albumid, $artistid, $diskid, $id, @diskid_refs, $ref); 

if (!exists $ARGS{diskid} || $ARGS{diskid} eq '' ||
    !exists $ARGS{albumid} || $ARGS{albumid} eq '')
{
    mc_comp("/comp/badargs");
    return undef;
}

$mb = new MusicBrainz;
$mb->Login();
$al = Album->new($mb->{DBH});
$di = Diskid->new($mb->{DBH});

$diskid = $ARGS{diskid};
$albumid = $ARGS{albumid};
@diskid_refs = $di->GetDiskIdFromAlbum($albumid);
if (scalar(@diskid_refs) == 0)
{
    mc_out("Invalid diskid and album passed.\n");
    return undef;
}

$id = -1;
foreach $ref (@diskid_refs)
{
    if ($ref->{diskid} eq $diskid)
    {
        $id = $ref->{id};
        last;
    }
}

if ($id < 0)
{
    mc_out("Invalid diskid and album passed.\n");
    return undef;
}

$al->SetId($albumid);
$al->LoadFromId();
$albumname = $al->GetName();
$artistid = $al->GetArtist();

</%perl>

% if (!defined $session{user} || $session{user} eq '') {
    You must be logged in to edit the database.<p>
    <& /comp/tablebegin, title=>'Login' &>
    <& /comp/loginbox &>
    <& /comp/tableend &>
% } else {

    <& /comp/tablebegin, gattrs=>"width=\"100%\"",
       title=>'Remove Diskid' &>

    <FORM METHOD="POST" ACTION="/bare/enter_mod.html" NAME="RemoveDiskidForm"
          ENCTYPE="application/x-www-form-urlencoded">  

    <table width="100%">
      <tr>
        <td colspan="2">
        Are you sure you want to remove CD Index Id <% $diskid %> from album
        <span class="bold"><% $albumname %></span>? <p>Please be sure you
        are certain that this CD Index Id is an error, since an Album
        can have multiple valid CD Index Ids. For more info, please see our
        <a href="/cd_submission.html">CD Submission</a> document.<p>
        </td>
      </tr>
      <tr>
        <td>
        &nbsp;
        </td>
        <td>
        <INPUT TYPE="radio" NAME="confirm0" SIZE=25 value="yes"> Yes
        </td>
      </tr>
      <tr>
        <td>
        &nbsp;
        </td>
        <td>
        <INPUT TYPE="radio" NAME="confirm0" SIZE=25 value="no" CHECKED> No
        </td>
      </tr>
      <tr>
        <td colspan=2>
        <INPUT TYPE="submit" NAME="Submit" VALUE="Submit">    
        </td>
      </tr>
    </table>
    <input type="hidden" name="artist0" value="<% $artistid %>">
    <input type="hidden" name="type0"
           value="<% ModDefs::MOD_REMOVE_DISKID %>">
    <input type="hidden" name="prev0" value="<% $diskid %>">
    <input type="hidden" name="new0" value="DELETE">
    <input type="hidden" name="table0" value="Diskid">
    <input type="hidden" name="column0" value="Disk">
    <input type="hidden" name="id0" value="<% $id %>">
    <input type="hidden" 
           name="url" value="/showalbum.html?albumid=<% $albumid %>">
    </form>
      
    <& /comp/tableend &>
% }
% $mb->Logout();

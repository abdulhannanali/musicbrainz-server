%# vi: set ts=4 sw=4 ft=mason :
<%perl>

$session{"freedb_ready"}
	or return $m->comp("/comp/redirect", "/freedb/freedb.html");

my $ar = Artist->new(undef);
$ar->SetId($session{"freedb_artistid"});
$ar->SetName($session{'freedb_artist'});
$ar->SetSortName($session{'freedb_sortname'});

my $t = $session{"freedb_tracks"};

</%perl>
<& /comp/sidebar, title => "FreeDB Import - Confirm Import" &>


<fieldset>
	<legend>Review Artist and Track Names</legend>

	<div class="padleft">
		You are about to add the following release to MusicBrainz:
	</div>

	<div class="padtop">
		<table>
			<tr>
				<td><label>Artist:</label></td>
				<td><a href="/showartist.html?artistid=<% &ModDefs::VARTIST_ID %>">Various Artists</a></td>
				<td></td>
			</tr>
			<tr>
				<td><label>Album:</label></td>
				<td><% $session{'freedb_album'} %></td>
				<td></td>
			</tr>
		</table>
	</div>
	<div class="padtop">
		<table>
			<tr>
				<td><b>#</td>
				<td rowspan="<% $t+1 %>">&nbsp;</td>
				<td><b>Artist Name:</td>
				<td rowspan="<% $t+1 %>">&nbsp;</td>
				<td><b>Track Name:</td>
			</tr>
% for my $i (0 .. $t-1) {
			<tr>
				<td><b><% $i+1 %>:</td>
				<td>
% if (my $id = $session{"freedb_artistid$i"}) {
					<a href="/showartist.html?artistid=<% $id %>">
						<% $session{"freedb_artistname$i"} %></a>
% } else {
					<% $session{"freedb_artistname$i"} %>
% if ($session{"freedb_artistname$i"} ne $session{"freedb_sortname$i"}) {
					(<% $session{"freedb_sortname$i"} %>)
% }
% }
				</td>
				<td><% $session{"freedb_track$i"} %></td>
			</tr>
% }
		</table>
	</div>

	<div class="padlefttop">
		<table>
			<tr>
				<td>
					<form method="post" action="/freedb/mac-edittracks.html">
						<input type="submit" class="button" value="Keep Editing">
					</form></td>
				<td>
					<form method="post" action="/freedb/cancel.html">
						<input type="submit" class="button" value="Abandon Import">
					</form></td>
				<td>
					<form method="post" action="/freedb/final.html">
						<input type="submit" class="button" value="Continue">
					</form></td>
			</tr>
		</table>
	</div>
</fieldset>

<& /comp/footer &>

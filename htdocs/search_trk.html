<& /comp/sidebar, title=>'Track Search Results' &>

<%perl>

# TODO: The data in the rows is not escaped!
if (!exists $ARGS{track} || $ARGS{track} eq '')
{
    mc_comp("/comp/badargs");
    return;
}

my ($mb); 
my (@data, $i, $row, $tr);

$mb = new MusicBrainz;
$mb->Login();
$tr = Track->new($mb->{DBH});
@data = $tr->SearchByName($ARGS{track});
if (scalar(@data) > 0)
{
</%perl>
    <& /comp/tablebegin, title=>'Found Albums' &>

    Click on the album to view that album or click on the artist to
    view all the albums by that artist:

    <table><tr><th>Track</th><th>Album</th><th>Artist</th></tr>
%   for($i = 0;; $i++) {
%      $row = $data[$i];
%      last if (!defined $row);
       <tr>
         <td>
           <a href="/showalbum.html?albumid=<% $$row[2] %>">
           <% $$row[1]  %></a>
         </td>
         <td>
           <a href="/showalbum.html?albumid=<% $$row[2] %>">
           <% $$row[3]  %></a>
         </td>
         <td>
           <a href="/showartist.html?artistid=<% $$row[4] %>">
           <% $$row[5]  %></a>
         </td>
       </tr>
%   }
    </table>
    <& /comp/tableend &>
%} else {
    There were no items found. Please try again:<p>
    <& /comp/tracksearchbox &>
%}
% $mb->Logout();

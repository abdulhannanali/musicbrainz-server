<%perl>
# -----------------------------------------------------------------------------
#                               Musicbrainz.org
#                        Copyright (c) 2001 Robert Kaye
# -----------------------------------------------------------------------------
#  This software is provided "as is", without warranty of any kind, express or
#  implied, including  but not limited  to the warranties of  merchantability,
#  fitness for a particular purpose and noninfringement. In no event shall the
#  authors or  copyright  holders be  liable for any claim,  damages or  other
#  liability, whether  in an  action of  contract, tort  or otherwise, arising
#  from,  out of  or in  connection with  the software or  the  use  or  other
#  dealings in the software.
#
#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
#  Permits anyone the right to use and modify the software without limitations
#  as long as proper  credits are given  and the original  and modified source
#  code are included. Requires  that the final product, software derivate from
#  the original  source or any  software  utilizing a GPL  component, such  as
#  this, is also licensed under the GPL license.
# -----------------------------------------------------------------------------
#
# Summary:
# -----------------------------------------------------------------------------
# This page lists all aliases of an artist
#
# $Id$
#
</%perl>
<%args>

	$artistid => ""

</%args>
<%perl>

	# Check argument
	MusicBrainz::Server::Validation::IsNonNegInteger($artistid) && $artistid
		or return $m->comp("/comp/layout/badarguments",
			text => "Argument <code>artistid</code> is required");


	# Instantiate MusicBrainz object, and load artist
	my $mb = $m->comp("/comp/dblogin");
	my $artist = $m->comp("/comp/loadartist", $mb, $artistid);


	my $title = "Aliases for artist: ".$artist->GetName;

	$m->comp("/comp/sidebar-notitle", pagetitle => $title);
	$m->comp("/comp/artisttitle", artist => $artist, showratings => 1);

	my $alias = MusicBrainz::Server::Alias->new($mb->{DBH}, "ArtistAlias");
	my @list = $alias->GetList($artist->GetId);

	# see if one of the releases has a moderation pending flag.
	my $mp = 0;
	for my $item (@list)
	{
		$mp ||= $item->[4];
	}
	$m->comp("/comp/layout/editformbegin", title => $title,
		mp_type => &ModDefs::MOD_EDIT_ARTISTALIAS, mp => $mp);

	# list artist aliases
	if (!defined $list[0])
	{
		$m->out("This artist has no aliases.");
	}
	else
	{

</%perl>

	<table class="formstyle">
		<tr>
			<td class="instructions">
				<ul>
					<li>MusicBrainz uses artist aliases mainly as variant names or search hints.&nbsp;
					If you see a misspelled alias here, it's most likely listed on purpose and should
					not be removed.&nbsp; See the documentation
					about <& /comp/linkdoc, "ArtistAlias", "artist aliases" &> for more details.</li>
				</ul>
			</td>
		</tr>
	</table>

	<table class="listing" style="clear:both">
		<tr class="header left">
			<td>Alias</td>
			<td>Times used</td>
			<td>Last used</td>

% 		if (exists $session{user})
%		{

			<td>&nbsp;</td>

% 		}

		</tr>

%		for (my $i=0; $i < @list; $i++)
%		{
%			my $item = $list[$i];
%			my $time = "never";
%			$time = $m->comp("/comp/datetime", $item->[3])
%				unless $item->[3] =~ /^1970-01-01/;

			<tr class="left <% $i%2 ? "even" : "odd" |n %>">
				<td <% $item->[4] ? 'class="mp"' : "" |n %>><% $item->[1] %></td>
				<td><% $item->[2] %></td>
				<td><% $time %></td>

% 			if (exists $session{user})
%			{

				<td>
					[ <a href="/edit/artistalias/edit.html?id=<% $item->[0] %>">Edit</a>
					| <a href="/edit/artistalias/remove.html?id=<% $item->[0] %>">Remove</a> ]</td>

% 			}

			</tr>

%		}

	</table>

% 	}

% 	if ($session{uid})
%	{

	<a href="/edit/artistalias/add.html?id=<% $artist->GetId %>">Add New Alias</a>

% 	}

	<& /comp/layout/editformend &>

<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

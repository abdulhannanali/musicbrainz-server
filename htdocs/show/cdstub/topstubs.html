<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# Show database details of top active CD Stub.
	#
	# $Id: index.html 8548 2006-10-19 07:41:02Z dave $
	#
</%perl>
<%args>
	$count => undef
	$offset => 0
	$limit => 25
</%args>
<%perl>
	# Prevent use of too large value for the limit parameter
	$limit = 25 if $limit > 100;

	# Instantiate MusicBrainz object
	my $mb = MusicBrainz->new;
	$mb->Login(db => "RAWDATA");

	my $rc = MusicBrainz::Server::CDStub->new($mb->{DBH});
    my ($data, $numitems, $timestamp) = $rc->GetActiveCDs($limit, $offset);
	$timestamp = MusicBrainz::Server::DateTime::format_datetime_since($timestamp);
	
</%perl>
<& /comp/sidebar-notitle, pagetitle => "Most active CD Stubs" &>


%	if (scalar(@$data)) {
	<& /comp/tablebegin, title => "Most active CD Stubs" &>
		<table class="searchresults">
			<tr>
			<td><b>Title</b></td>
			<td><b>Artist</b></td>
			<td><b>Added</b></td>
			<td><b>Modified</b></td>
			<td><b>Lookup<br/>count</b></td>
			<td><b>Modify<br/>count</b></td>
%			if ($session{uid}) {
				<td><b>Import</b></td>
%			}
			</tr>
%		foreach my $row (@{$data}) {
%			$row->{trackoffset} =~ s/^{(.*?)}$/$1/g;
%			$row->{trackoffset} =~ s/,/+/g;
%			my $url = "/bare/cdlookup.html?discid=" . $row->{discid} . 
%						"&toc=1+" . $row->{trackcount} . "+" . $row->{leadoutoffset} . "+" .$row->{trackoffset};
%			if ($row->{artist}) {
%				$url .=	"&artist=" . uri_escape($row->{artist});
%			} else {
%				$url .=	"&release=" . uri_escape($row->{title});
%			}
			<tr class="searchresults<% ("odd", "even")[++$. % 2] %>">
			<td><a href="index.html?discid=<% $row->{discid} %>" title="View this CD Stub"><% $row->{title} %></a></td>
			<td><% $row->{artist} || "Various Artists" %></td>
			<td><% MusicBrainz::Server::DateTime::format_datetime_since($row->{added}) %></td>
			<td><% MusicBrainz::Server::DateTime::format_datetime_since($row->{lastmodified}) %></td>
			<td><% $row->{lookupcount} %></td>
			<td><% $row->{modifycount} %></td>
%			if ($session{uid}) {
				<td style="white-space: nowrap;"><a href="/edit/cdstub/import.html?cdstubid=<% $row->{id} %>">release</a>
				| <a href="<% $url %>">disc id</a></td>
%			}
			</tr>
%		}
		<tr>
			<td colspan="7">
				<& /comp/pageselector, offset => $offset, pagesize => $limit,
										url => '/show/cdstub/topstubs.html',
										args => { "limit" => $limit },
										numitems => $numitems &>
			</td>
		</tr>
		</table>
		<& /comp/tableend &>
		<p class="lastupdated">Updated <% $timestamp %></p>
%	} else {
		<& /comp/tablebegin, title => "No CD Stubs" &>
		<p>There are no CD Stubs to show.</p>
		<& /comp/tableend &>
%	}


<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# This page shows the vote requirements/durations for each edit type and
    # each edit level.
	#
	# $Id: approve.html 8548 2006-10-19 07:41:02Z dave $
	#
</%perl>
<& /comp/sidebar, title => "Edit Conditions" &>

<p style="margin-bottom: 1em;">
This page shows the available edit types and what the requirements are for getting
an edit applied to the database. Each edit type is listed three times below; one for each 
of the quality levels: 
<% ModDefs::GetQualityText(&ModDefs::QUALITY_LOW) %>, 
<% ModDefs::GetQualityText(&ModDefs::QUALITY_NORMAL) %> and
<% ModDefs::GetQualityText(&ModDefs::QUALITY_HIGH) %>. 
</p>

<p style="margin-bottom: 1em;">
When changing the quality of an artist or release, the following edit values apply:
</p>

<%perl>

my ($level, $quality, $type, $category, $class);

require MusicBrainz::Server::Artist;
require ModDefs;
use Data::Dumper;

$m->out('<table class="topmods"><tr>');
$m->out('<th>Type</th><th>Voting Period<br/>(days)</th>');
$m->out('<th>Votes<br/>(unanimous)</th><th>Expire Action</th>');
$m->out('<th>Auto Edit</th></tr>');

for(0..1)
{
    $level = Moderation::GetQualityChangeDefs($_);
    $m->out('<tr>');
    $m->out('<td align="center">' . ($_ == 0 ? "Lower Quality" : "Raise Quality") . '</td>');
    $m->out('<td align="center">' . $level->{duration} . '</td>');
    $m->out('<td align="center">' . $level->{votes} . '</td>');
    $m->out('<td align="center">' . ModDefs::GetExpireActionText($level->{expireaction}) .'</td>');
    $m->out('<td align="center">' . ($level->{autoedit} ? "yes" : "no").'</td>');
    $m->out('</tr>');
}
$m->out('</table><br/>');

</%perl>
<p style="margin-bottom: 1em;">
For each edit type and each quality level the table below shows the voting 
period that an edit will remain open for, the number of unanimous votes required 
to shortcut the edit period, what happens if the edit expires but has no votes, 
and whether or not an edit is considered an <& /comp/linkdoc, "AutoEdit", "auto-edit" &> for an <&/comp/linkdoc, "AutoEditor", "auto-editor" &>.
</p>

<%perl>

# Create the table headers
$m->out('<table class="topmods">');
$m->out('<thead><tr>');
$m->out('<th rowspan="3">Type</th><th colspan="12">Data Quality Level</th><th rowspan="3">Criteria</th>');
$m->out('</tr><tr>');

my $index = 1;
foreach $quality (&ModDefs::QUALITY_LOW, &ModDefs::QUALITY_NORMAL, &ModDefs::QUALITY_HIGH)
{
	$m->out('<th colspan="4" class="topmods' . (($index++ % 2) ? "even" : "odd") . '">' . ucfirst ModDefs::GetQualityText($quality) . '</th>');
}

$m->out('</tr><tr>');

$index = 1;
foreach $quality (&ModDefs::QUALITY_LOW, &ModDefs::QUALITY_NORMAL, &ModDefs::QUALITY_HIGH)
{
	$class = 'topmods' . (($index++ % 2) ? 'even' : 'odd');
	
	$m->out('<th class="' . $class . '">Voting<br />Period<a class="superscript" href="#note-1">1</a></th>');
	$m->out('<th class="' . $class . '">Votes<a class="superscript" href="#note-2">2</a></th>');
	$m->out('<th class="' . $class . '">Expire<br />Action<a class="superscript" href="#note-3">3</a></th>');
	$m->out('<th class="' . $class . '">Auto<br />Edit</th>');
}


$m->out('</tr></thead>');

my %ref = ModDefs::GetModCategories();

# Create the table content
foreach $category (&ModDefs::CAT_ARTIST, &ModDefs::CAT_RELEASE, &ModDefs::CAT_DEPENDS, &ModDefs::CAT_NONE)
{
	$m->out('<tbody>');
	$m->out('<tr><th colspan="14" class="subheader">' . ModDefs::GetModCategoryTitle($category) . '</th></tr>');

	my %names = '';

	foreach $type (Moderation::GetEditTypes())
	{
		$level = Moderation::GetEditLevelDefs(&ModDefs::QUALITY_NORMAL, $type);
		
		if ($ref{$type}->{'category'} == $category)
		{
			$names{$level->{name}} = {'type' => $type, 'criteria' => $ref{$type}->{'criteria'}};
		}
	}

	# Let's not include the old edit types
	delete @names{'Edit Release Events (old version)', 'Add Track (old version)', 'Edit Artist Name', 'Edit Artist Sortname'};

	foreach my $k (sort keys %names)
	{
		if ($k)
		{
			$m->out('<tr>');
			$m->out('<td>' . $k . (Moderation::GetEditLevelDefs($quality, $names{$k}{'type'})->{duration} == 0 ? '<a class="superscript" href="#note-4">4</a>' : '') . '</td>');
			
			$index = 1;
			foreach $quality (&ModDefs::QUALITY_LOW, &ModDefs::QUALITY_NORMAL, &ModDefs::QUALITY_HIGH)
			{
				$class = 'topmods' . (($index++ % 2) ? 'even' : 'odd');

				# Only display the values of the default quality column when we are dealing with level independent edits
				if ($category == &ModDefs::CAT_NONE && $quality != &ModDefs::QUALITY_NORMAL)
				{
					$m->out('<td align="center" class="' . $class . '">&nbsp;</td>');
					$m->out('<td align="center" class="' . $class . '">&nbsp;</td>');
					$m->out('<td align="center" class="' . $class . '">&nbsp;</td>');
					$m->out('<td align="center" class="' . $class . '">&nbsp;</td>');
					
					next;
				}
				
				my $refQuality = Moderation::GetEditLevelDefs($quality, $names{$k}{'type'});
				
				$m->out('<td align="center" class="' . $class . '">' . ($refQuality->{duration} == 0 ? "-" : $refQuality->{duration}) . '</td>');
				$m->out('<td align="center" class="' . $class . '">' . ($refQuality->{votes} == 0 ? "-" : $refQuality->{votes}) . '</td>');
				$m->out('<td align="center" class="' . $class . '">' . ($refQuality->{duration} == 0 ? 'N/A': ModDefs::GetExpireActionText($refQuality->{expireaction})) . '</td>');
				$m->out('<td align="center" class="' . $class . '">' . ($refQuality->{votes} == 0 ? 'N/A': ($refQuality->{autoedit} ? "yes" : "no")) . '</td>');
			}

			$m->out('<td>' . $names{$k}{'criteria'} . '</td>');

			$m->out('</tr>');
		}
	}

	$m->out('</tbody>');
}


$m->out('</table><br/>');

</%perl>

<p>
	<span id="note-1" class="superscript">1</span> Voting period in days<br />
	<span id="note-2" class="superscript">2</span> Unanimous votes<br />
	<span id="note-3" class="superscript">3</span> Expire action when edit has no votes (abstain votes excluded)<br />
	<span id="note-4" class="superscript">3</span> <& /comp/linkdoc, "AutoEdit", "auto-edit" &> for all users
</p>

<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

<%args>
    $id
	$type
	$tag
</%args>

<%perl>

	my $mb = $m->comp("/comp/dblogin");
    $m->comp("/comp/checkloggedin", 1, 1, undef, 1)
		or return;
	
	my $t = MusicBrainz::Server::Tag->new($mb->{DBH});
	my $editors = $t->GetEditorsForEntityAndTag($type, $id, $tag);

	my $entity = $m->comp("/comp/load$type", $mb, $id);

    $m->comp("/comp/sidebar", pagetitle => "Editors who tagged $type " . $m->interp->apply_escapes($entity->GetName, 'h') .":");

    $m->out('<div class="TagsBox">');

    if (!defined $editors)
    {
        $m->out("<p>No one tagged $type ");
        $m->comp("/comp/link$type", $type=>$entity);
        $m->out(" with '<b>$tag</b>'. Losers, all of them!</p>");
    }
    elsif (scalar(@{$editors}) == 0)
    {
        $m->out("<p>The $type ");
        $m->comp("/comp/link$type", $type=>$entity);
        $m->out(" tagged with '<b>$tag</b>' was only tagged by editors who didn't make their tags public.");
        $m->out(" Shame on them for not sharing!</p>");
    }
    else
    {
        $m->out("<p>The following editors tagged $type ");
        $m->comp("/comp/link$type", $type=>$entity);
        $m->out(" with '<b>$tag</b>':");
        $m->out("<table>");
        foreach my $ed (@{$editors})
        {
            $m->out("<tr><td><a href=\"/show/user/?username=" . uri_escape($ed->{name}) . "\">" . $ed->{name} . "</a></td></tr>");
        }
        $m->out("</table><p> Editors who didn't make their tags public are not shown.</p>");
    }
    </%perl>
    </div>

    <& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

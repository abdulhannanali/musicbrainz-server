<%args>
	$tag => ''
    $show => 'all'
</%args>

<%perl>
	# Instantiate MusicBrainz object, and load entity
	my $mb = $m->comp("/comp/dblogin");
	my $t = MusicBrainz::Server::Tag->new($mb->{DBH});
	my $entities;

    if (!$tag)
    {
        </%perl>
        <& /comp/sidebar, pagetitle => "Tag details" &>

        <form method="post" action="/show/tag/index.html">
        <p>
        Enter a tag name to display:
        <input type="text" size="15" name="tag"/>
        </p>
        <br/>
        <input type="submit" value="Show details"/>
        </form>
        <& /comp/footer &>
        <%perl>
        return undef;
    }
</%perl>

<& /comp/sidebar, pagetitle => "Tag details: $tag" &>

[ Show tag for:
% if ($show ne 'all') {
    <a href="/show/tag/?tag=<% uri_escape($tag) %>&show=all">all</a> |
% }
% if ($show eq 'artist') {
    artists |
% } else {
    <a href="/show/tag/?tag=<% uri_escape($tag) %>&show=artist">artists</a> |
% }
% if ($show eq 'label') {
    labels |
% } else {
    <a href="/show/tag/?tag=<% uri_escape($tag) %>&show=label">labels</a> |
% }
% if ($show eq 'release') {
    releases |
% } else {
    <a href="/show/tag/?tag=<% uri_escape($tag) %>&show=release">releases</a> |
% }
% if ($show eq 'track') {
    tracks ]
% } else {
    <a href="/show/tag/?tag=<% uri_escape($tag) %>&show=track">tracks</a> ]
% }

% if ($show eq 'all' || $show eq 'artist') {
<h2>Artists</h2>
<table>
%	$entities = $t->GetEntitiesForTag("artist", $tag, 100);
%	for my $entity (@$entities) {
		<tr>
			<td><& "/comp/linkartist", id => $entity->{"id"}, mbid => $entity->{"gid"}, name => $entity->{"name"}  &></td>
			<td><% $entity->{"count"} %></td>
			<td><a href="/show/tag/editors.html?id=<% $entity->{"id"} %>&tag=<% uri_escape($tag) %>&type=artist">Who tagged this?</a></td>
		</tr>
%	}
</table>
% }

% if ($show eq 'all' || $show eq 'label') {
<h2>Labels</h2>
<table>
%	$entities = $t->GetEntitiesForTag("label", $tag, 100);
%	for my $entity (@$entities) {
		<tr>
			<td><& "/comp/linklabel", id => $entity->{"id"}, mbid => $entity->{"gid"}, name => $entity->{"name"}  &></td>
			<td><% $entity->{"count"} %></td>
			<td><a href="/show/tag/editors.html?id=<% $entity->{"id"} %>&tag=<% uri_escape($tag) %>&type=label">Who tagged this?</a></td>
		</tr>
%	}
</table>
% }

% if ($show eq 'all' || $show eq 'release') {
<h2>Releases</h2>
<table>
%	$entities = $t->GetEntitiesForTag("release", $tag, 100);
%	for my $entity (@$entities) {
		<tr>
			<td><& "/comp/linkrelease", id => $entity->{"id"}, mbid => $entity->{"gid"}, name => $entity->{"name"}  &></td>
			<td><% $entity->{"count"} %></td>
			<td><a href="/show/tag/editors.html?id=<% $entity->{"id"} %>&tag=<% uri_escape($tag) %>&type=release">Who tagged this?</a></td>
		</tr>
%	}
</table>
% }

% if ($show eq 'all' || $show eq 'track') {
<h2>Tracks</h2>
<table>
%	$entities = $t->GetEntitiesForTag("track", $tag, 100);
%	for my $entity (@$entities) {
		<tr>
			<td><& "/comp/linktrack", id => $entity->{"id"}, mbid => $entity->{"gid"}, name => $entity->{"name"}  &></td>
			<td><% $entity->{"count"} %></td>
			<td><a href="/show/tag/editors.html?id=<% $entity->{"id"} %>&tag=<% uri_escape($tag) %>&type=track">Who tagged this?</a></td>
		</tr>
%	}
</table>
% }

<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

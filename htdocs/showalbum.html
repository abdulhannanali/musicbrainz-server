<%perl>

my ($mb); 
my ($artist, $album, $albumid); 

$mb = new MusicBrainz;
$mb->Login();

if (exists $ARGS{diskid} && $ARGS{diskid} ne '')
{
    my $di;

    $di = Diskid->new($mb->{DBH});
    $albumid = $di->GetAlbumFromDiskId($ARGS{diskid});
    if (!defined $albumid)
    {
        mc_comp("/comp/sidebar", title=>"Error");
        mc_out("Diskid $ARGS{diskid} was not found in the database.");
        return;
    }
}

if (!defined $albumid && (!exists $ARGS{albumid} || $ARGS{albumid} eq ''))
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_comp("/comp/badargs");
    return;
}

$albumid = $ARGS{albumid} if (!defined $albumid);

$album = Album->new($mb->{DBH});
$album->SetId($albumid);

if (! $album->LoadFromId())
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_out("This Album (ID=$albumid) was not found<br>");
}
else
{
    $artist = Artist->new($mb->{DBH});
    $artist->SetId($album->GetArtist());
    if (!defined $artist->LoadFromId())
    {
        mc_comp("/comp/sidebar", title=>"Error");
        mc_out("Could not load album.");
    }
    else
    {
        mc_comp("/comp/sidebar", title=>'',
                pagetitle=>"Album: " . $album->GetName());
        mc_comp("/comp/artisttitle", artist=>$artist);
        mc_out("[ <a href=\"/showartist.html?artistid=");
        mc_out($artist->GetId());
        mc_out("\">View albums</a> | ");

        mc_out("<a href=\"/addalbum.html?artistid=");
        mc_out($artist->GetId());
        mc_out("\">Add album</a> ]<p>\n");


        mc_comp("/comp/modnotice");
        mc_comp("/comp/album", album=>$album, artist=>$artist, 
                               showalbumdetail=>1);
    }
}
$mb->Logout();

</%perl>


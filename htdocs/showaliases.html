%# vi: set ts=4 sw=4 ft=mason :
<%args>
$artistid => ""
</%args>
<%perl>

MusicBrainz::IsNonNegInteger($artistid) && $artistid
	or return $m->comp("/comp/badargs", 1, 1);

my $mb = $m->comp("/comp/dblogin");

my $artist = Artist->new($mb->{DBH});
$artist->SetId($artistid);
$artist->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist #$artistid not found",
		1, 1,
	);

$m->comp("/comp/sidebar", title => "Artist Aliases");

</%perl>

<p>
	[
	<a href="/showartist.html?artistid=<% $artist->GetId %>"
		>View albums</a>
% if (exists $session{user}) {
	|
	<a href="/addalias.html?id=<% $artist->GetId %>"
		>Add alias</a>
% }
	]
</p>

<%perl>

my $alias = Alias->new($mb->{DBH}, "ArtistAlias");
my @list = $alias->GetList($artist->GetId);

if (!defined $list[0])
{
	$m->out("<p>There are no aliases for this artist.</p>");
	$m->comp("/comp/footer");
	return;
}

</%perl>

<h2>Aliases for '<% $artist->GetName %>'</h2>

<& /comp/modnotice &>

<table class="SpacedColumns">
	<tr>
		<th>Alias</th>
		<th style="text-align: right">Times Used</th>
		<th>Last Used</th>
% if (exists $session{user}) {
		<th></th>
% }
	</tr>

	<%perl>
    for my $item (@list)
    {
		my $time = $m->comp("/comp/datetime", $item->[3]);

		</%perl>
		<tr>
			<td
				<% $item->[4] ? "bgcolor='#FFFFCC'" : "" %>
				><% $item->[1] %></td>
			<td style="text-align: right"><% $item->[2] %></td>
			<td><% $time %></td>
% if (exists $session{user}) {
			<td>
				[ <a href="/remartistalias.html?alias=<% $item->[0] %>"
					>Delete</a> ]
			</td>
% }
		</tr>
		<%perl>
    }
	</%perl>

</table>

<& /comp/tableend &>

<& /comp/footer &>

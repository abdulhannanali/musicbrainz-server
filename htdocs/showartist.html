<%perl>

my ($mb); 
my (@albums, $artist, $album); 

if (!exists $ARGS{artistid} || $ARGS{artistid} eq '')
{
    mc_comp("/comp/badargs");
    return;
}

my ($ret, $t0, $t1, $td);
my ($secs);

$mb = new MusicBrainz;
$mb->Login();
$artist = Artist->new($mb->{DBH});
$album = Album->new($mb->{DBH});

$artist->SetId($ARGS{artistid});
if (! $artist->LoadFromId())
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_out("This artist (id=$ARGS{artistid}) was not found in the database.");
}
elsif ($ARGS{artistid} == Artist::VARTIST_ID)
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_out("You cannot view all Various Artist albums using this page. Sorry.");
}
else
{
    @albums = $artist->GetAlbums();
    
    mc_comp("/comp/sidebar", title=>'',
            pagetitle=>"Artist: " . $artist->GetName());
    mc_comp("/comp/artisttitle", artist=>$artist);
    if ($artist->GetName() ne "Unknown" && 
        $artist->GetId() != Artist::VARTIST_ID && 
        $artist->GetName() ne "Data CD")
    {
        mc_out("[ <a href=\"/showaliases.html?artistid=");
        mc_out($artist->GetId());
        mc_out("\">View aliases</a> | ");
        mc_out("<a href=\"/addalbum.html?artistid=");
        mc_out($artist->GetId());
        mc_out("\">Add album</a> | ");
        mc_comp("/comp/googlelink", search=>($artist->GetName()), 
            text=>"Search Google"); 
        mc_out("]<p>");
    }
    mc_comp("/comp/modnotice");
    
    for(;;)
    {
        $album = shift @albums;
        last if (!defined $album);
        mc_comp("/comp/album", album=>$album, artist=>$artist, showid=>1);
    }
}

$mb->Logout();

</%perl>

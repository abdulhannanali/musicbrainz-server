<%perl>

my ($mb); 
my (@albums, $artist, $album); 

if (!exists $ARGS{artistid} || $ARGS{artistid} eq '')
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_comp("/comp/badargs");
    return undef;
}

my ($ret, $t0, $t1, $td, $ex);
my ($secs);

$mb = new MusicBrainz;
$mb->Login();
$artist = Artist->new($mb->{DBH});
$album = Album->new($mb->{DBH});
$ex = $ARGS{ex};

$artist->SetId($ARGS{artistid});
if (! $artist->LoadFromId())
{
    mc_comp("/comp/sidebar", title=>"Error");
    mc_out("This artist (id=$ARGS{artistid}) was not found in the database.");
}
else
{
    mc_comp("/comp/sidebar", title=>'',
            pagetitle=>"Artist: " . $artist->GetName());

    if ($ARGS{artistid} == Artist::DARTIST_ID)
    {
        mc_out("<font size=\"+2\">Deleted Artist</font><p>");
        mc_out("<table width=\"100%\"><tr><td align=\"center\">");
        mc_out("<font size=\"+1\">This artist is a placeholder for the ");
        mc_out("moderation system. Please do not use it.</font>");
        mc_out("</td></tr></table>");
        return undef;
    }

    mc_comp("/comp/artisttitle", artist=>$artist);
    
    mc_out("[ <a href=\"/addalbum.html?artistid=");
    mc_out($artist->GetId());
    mc_out("\">Add album</a> ");

    if ($artist->GetName() ne "Unknown" && 
        $artist->GetId() != Artist::VARTIST_ID && 
        $artist->GetId() != Artist::DARTIST_ID && 
        $artist->GetName() ne "Data CD")
    {
         
        mc_out("| <a href=\"/moderate.html?type=4&artistid=".
               $artist->GetId()."\">");
        mc_out("View mods</a> ");

        mc_out("| <a href=\"/showaliases.html?artistid=");
        mc_out($artist->GetId());
        mc_out("\">View aliases</a> | ");
        mc_comp("/comp/googlelink", search=>($artist->GetName()), 
            text=>"Search Google"); 
    }
    mc_out("]<p>");

    if ($ARGS{artistid} == Artist::VARTIST_ID)
    {
        mc_out("<table width=\"100%\"><tr><td align=\"center\">");
        mc_out("<font size=\"+1\">There are too many albums to list.</font>");
        mc_out("<br>Please use the <a href=\"search.html\">Search Page</a>");
        mc_out(" to look for a specific album.");
        mc_out("</td></tr></table>");
    }
    else
    {

        mc_comp("/comp/modnotice");
        @albums = $artist->GetAlbums();
        if (scalar(@albums) == 0)
        {
            mc_out("<center>This artist has no albums.<br>");
            mc_out("[ <a href=\"remartist.html?artist=$ARGS{artistid}\">");
            mc_out("Remove this artist</a> ]</center><br>");
        }
        else
        {
            my ($count, $exall, $id);

            $count = 0;
            foreach $album (@albums)
            {
                $id = $album->GetId();
                $exall .= "," if ($count > 0);
                $exall .= $id;
                $count++;
            }

            </%perl>
            <table width="100%">
            <tr><td align="center">

            <a href="/showartist.html?artistid=<% $artist->GetId() %>&ex=<% $exall %>">
            <img src="/images/plus.gif" align="center"
                 alt="Expand" title="Expand All Albums"
                 height="13" width="13" border="0"> Expand All</a>

            </td><td align="center">

            <a href="/showartist.html?artistid=<% $artist->GetId() %>">
            <img src="/images/minus.gif" align="center""
                 alt="Collapse" title="Collapse All Albums"
                 height="13" width="13" border="0"> Collapse All</a>

            </td></tr></table>
            <%perl>

            foreach $album (@albums)
            {
                $id = $album->GetId();
                $exall .= "," if ($count > 0);
                $exall .= $id;

                if ($ex =~ /(^|\D)$id(\D|$)/)
                {
                     mc_comp("/comp/album", 
                             album=>$album, 
                             artist=>$artist, 
                             ex=>$ex,
                             showcollapsed=>1,
                             showid=>1);
                }
                else
                {
                     mc_comp("/comp/albumcollapsed", 
                             album=>$album, 
                             artist=>$artist, 
                             ex=>$ex,
                             showid=>0);
                }
            }
        }

    }
}

$mb->Logout();

</%perl>

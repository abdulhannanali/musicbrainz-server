<& /comp/sidebar, title=>'Show GUID' &>
<%perl>

my ($mb, $gu, $album, $artist); 
my ($albumid, $trackid, @albums); 

if (!exists $ARGS{guid})
{
    mc_out("This page needs a guid argument.");
}
else
{
   mc_out("<font size=+1><b>Guid: $ARGS{guid}</b></font><p>");

   if ($ARGS{guid} eq "3ab1d2ba-ca38-47d8-b8cc-49f3ced39895")
   {
       mc_out("<p><br>This GUID represents silence.<p>");
   }
   else
   {
       $mb = new MusicBrainz;
       $mb->Login();
       $artist = Artist->new($mb->{DBH});
       $album = Album->new($mb->{DBH});
       $gu = GUID->new($mb->{DBH});
    
       $trackid = $gu->GetTrackIdFromGUID($ARGS{guid});
       if (!defined $trackid)
       {
           mc_out("<p>This GUID was not found in the main database.<p>");
       }
       else
       {
           @albums = $album->GetAlbumIdsFromTrackId($trackid);
           for(;;)
           {
              $albumid = shift @albums;
              last if (!defined $albumid);

              $album->SetId($albumid);
              if ($album->LoadFromId())
              {
                 $artist->SetId($album->GetArtist());
                 if ($artist->LoadFromId())
                 {
                     mc_comp("comp/album", album=>$album, 
                             artist=>$artist); 
                 }
              }
           }
       }

       mc_comp("/comp/title", title=>'Pending Metadata');
       mc_comp("/comp/showpendingpage", offset=>0, guid=>$ARGS{guid});
       mc_comp("/comp/title", title=>'Pending Archive Metadata');
       mc_comp("/comp/showpendingpage", offset=>0, 
               guid=>$ARGS{guid}, archive=>1);

       $mb->Logout;
   }
}

</%perl>

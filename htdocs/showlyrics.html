<& /comp/sidebar &>
<%perl>

if (DBDefs::USE_LYRICS) {
my ($mb, $ly, $ar, $tr); 
my (@trackdata, $lyrics, $writer, @synctext);

if (!exists $ARGS{id} || $ARGS{id} eq '')
{
    mc_comp("/comp/badargs");
    return undef;
}

$mb = new MusicBrainz;
$mb->Login();

$ar = Artist->new($mb->{DBH});
$tr = Track->new($mb->{DBH});
$ly = Lyrics->new($mb->{DBH});

$tr->SetId($ARGS{id});
$tr->LoadFromId();

$ar->SetId($tr->GetArtist());
$ar->LoadFromId();

($lyrics,$writer) = $ly->GetLyricsFromTrackId($ARGS{id});
@synctext         = $ly->GetSyncTextList($ARGS{id});
if (defined($lyrics) || (scalar(@synctext) > 0)) {
</%perl>
    <& /comp/texts, trackname=>$tr->GetName(),
                    artistname=>$ar->GetName(),
                    writer=>$writer,
                    synctextids=>\@synctext,
                    lyrics=>$lyrics,
                    trackid=>$ARGS{id},
                    ly=>$ly &>
%} else {
    There were no items found.<p>
%}
% $mb->Logout();
%} else {
    <& /comp/nolyrics &>
%}
<& /comp/footer &>

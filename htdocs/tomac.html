%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => undef
</%args>
<%perl>

$m->comp("/comp/checkloggedin", 1, 1)
	or return;

MusicBrainz::IsNonNegInteger($album) && $album
	or return $m->comp("/comp/badargs", 1, 1);

my $mb = $m->comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
$al->SetId($album);
$al->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Album #$album does not exist",
		1, 1,
	);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($al->GetArtist);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist does not exist",
		1, 1,
	);

my $url = (
	$ARGS{'movetracks'}
		? "/changetrack.html?album=" . $al->GetId
		: "/showalbum.html?albumid=" . $al->GetId
);

if ($ARGS{confirm})
{
	$m->comp(
		"/comp/entermods",
		DBH => $mb->{DBH},
		sub => sub {
			my @mods = Moderation->InsertModeration(
				DBH	=> $mb->{DBH},
				uid	=> $session{uid},
				privs => $session{privs},
				type => &ModDefs::MOD_SAC_TO_MAC,
				# --
				album => $al,
				artist => $ar,
			);
		},
		success_url => $url,
	) or return;

	die "Shouldn't get here";
}

</%perl>

<& /comp/sidebar, title => 'Convert Album to Multiple Artists' &>

<h2>Convert Album '<% $al->GetName %>' to Multiple Artists</h2>

<p>
	Are you sure you want to convert the album
	'<a href="/showalbum.html?albumid=<% $al->GetId %>"><% $al->GetName %></a>',
	currently by
	'<a href="/showartist.html?artistid=<% $ar->GetId %>"><% $ar->GetName %></a>',
	to multiple artists?
</p>

<form method="get" action="<% $url %>"
	name="ModFormNo"
	onsubmit="history.go(-1); return false"
	style="float: left; margin-right: 2em; margin-top: 0"
	>
	<div>
		<input type="submit" value="&lt;&lt; NO">
	</div>
</form>

<form method="post" action="/tomac.html"
	name="ModFormYes"
	style="margin: 0"
	>
	<div>
		<input type="hidden" name="album" value="<% $al->GetId %>">
		<input type="hidden" name="confirm" value="1">
		<input type="submit" value="YES &gt;&gt;">
		&nbsp;
		<input type="checkbox" name="movetracks" value="1" checked>
		Move tracks to new artists
	</div>
</form>

<& /comp/movefocus, "ModFormNo", 0 &>
<& /comp/footer &>

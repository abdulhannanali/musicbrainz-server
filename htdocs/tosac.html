%# vi: set ts=2 sw=2 ft=mason :
<%args>
$album => undef
</%args>

<& /comp/sidebar, title => 'Change Album to Single Artist' &>

<%perl>

$m->comp("/comp/checkloggedin", 0, 1)
	or return;

MusicBrainz::IsNonNegInteger($album) && $album
	or return $m->comp("/comp/badargs", 0, 1);

my $mb = $m->comp("/comp/dblogin");

my $al = Album->new($mb->{DBH});
$al->SetId($album);
$al->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Album #$album does not exist",
		0, 1,
	);

my $ar = Artist->new($mb->{DBH});
$ar->SetId($al->GetArtist);
$ar->LoadFromId
	or return $m->comp(
		"/comp/error",
		"Artist does not exist",
		0, 1,
	);

</%perl>

<& /comp/stylemenu &>

<h2>Change Album '<% $al->GetName %>' to Single Artist</h2>

% if ($al->GetModPending) {
    <& /comp/modpending &>
% }

<p>
	Enter the artist <span class="bold">sortname</span> to
	whom you'd like to change the album
	<a href="/showalbum.html?albumid=<% $al->GetId %>"><% $al->GetName %></a>:
</p>

<form method="post" action="/artistfilter.html" name="ToSacForm"
	enctype="application/x-www-form-urlencoded">

	<p>
		New Artist Sortname:
		<input type="text" name="new0" size="25" value="<% $ar->GetSortName %>">
	</p>

	<p>
		<input type="submit" value="Submit">
	</p>

	<input type="hidden" name="mode" value="tosac">
	<input type="hidden" name="album" value="<% $al->GetName %>">
	<input type="hidden" name="artist0" value="<% $ar->GetId %>">
	<input type="hidden" name="type0" value="<% ModDefs::MOD_MAC_TO_SAC %>">
	<input type="hidden" name="prev0" value="Various Artists">
	<input type="hidden" name="table0" value="Album">
	<input type="hidden" name="column0" value="Artist">
	<input type="hidden" name="id0" value="<% $al->GetId %>">
	<input type="hidden" name="url" value="/showalbum.html?albumid=<% $al->GetId %>">
</form>

<& /comp/movefocus, "ToSacForm", "new0" &>
<& /comp/footer &>

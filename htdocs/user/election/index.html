<%perl>
	# -----------------------------------------------------------------------------
	#                               Musicbrainz.org
	#                        Copyright (c) 2001 Robert Kaye
	# -----------------------------------------------------------------------------
	#  This software is provided "as is", without warranty of any kind, express or
	#  implied, including  but not limited  to the warranties of  merchantability,
	#  fitness for a particular purpose and noninfringement. In no event shall the
	#  authors or  copyright  holders be  liable for any claim,  damages or  other
	#  liability, whether  in an  action of  contract, tort  or otherwise, arising
	#  from,  out of  or in  connection with  the software or  the  use  or  other
	#  dealings in the software.
	#
	#  GPL - The GNU General Public License    http://www.gnu.org/licenses/gpl.txt
	#  Permits anyone the right to use and modify the software without limitations
	#  as long as proper  credits are given  and the original  and modified source
	#  code are included. Requires  that the final product, software derivate from
	#  the original  source or any  software  utilizing a GPL  component, such  as
	#  this, is also licensed under the GPL license.
	# -----------------------------------------------------------------------------
	#
	# Summary:
	# -----------------------------------------------------------------------------
	# This page shows the list of autoeditor elections.
	#
	# $Id$
	#
</%perl>

<& /comp/sidebar-notitle, pagetitle => "Autoeditor Elections" &>
	<& /comp/tablebegin, title => "Autoeditor Elections" &>

<%perl>

	my $mb = $m->comp("/comp/dblogin");
	my $el = MusicBrainz::Server::AutomodElection->new($mb->{DBH});
	# $el->DoCloseElections;

	my $elections = $el->GetElections;

	my %c;
	my $us = UserStuff->new($mb->{DBH});

	my $drawuser = sub {
		my $uid = shift;
		my $obj = $c{$uid} ||= $us->newFromId($uid);
		$obj or return;
		$m->comp("/comp/linkuser", user => $obj, shorten => 0);

		"";
	};

</%perl>

%	if (@$elections)
%	{

	<!-- force scrollbar after ~20 entries -->
		<table class="listing">
			<tr class="header">
				<td class="left">Candidate</td>
				<td></td>
				<td class="left">Status</td>
				<td class="left">Proposed</td>
			</tr>

%		my $i = 0;
% 		for my $election (@$elections)
%		{
%			my $status = $election->GetStatusName;


		<tr class="<% $i++ % 2 == 0 ? "even" : "odd" %>">
				<td class="left" style="padding-right: 40px"><% &$drawuser($election->GetCandidate) %></td>
				<td class="<% $status %>"><span>&nbsp;</span></td>
				<td class="left" style="padding-right: 40px"><% $status %></td>
				<td class="left" style="padding-right: 40px"><% $m->comp("/comp/datetime", $election->GetProposeTime) %></td>
				<td class="left" style="padding-right: 40px">[ <a href="show.html?id=<% $election->GetId %>">View details</a> ]</td>
			</tr>

% 		}

		</table>

% 	}
%	else
%	{

	<p>There are no elections to display.</p>

% 	}

% 	if (UserStuff->IsAutoMod($session{privs}))
%	{

	<& /comp/tableend &>

	<& /comp/tablebegin, title => "Propose a Candidate" &>

		<form method="post" action="propose.html">
			<table class="formstyle">
				<tr>
					<td class="label">Candidate Name:</td>
					<td>
						<input type="text" name="username" />
						<input type="submit" value="Propose" />
					</td>
				</tr>
			</table>
		</form>

% 	}

	<& /comp/tableend &>
<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :

%# vi: set ts=4 sw=4 ft=mason :
<%args>

	$userid => undef

</%args>
<%perl>

	if (defined $userid)
	{
		# make sure we got a valid user parameter
		MusicBrainz::Server::Validation::IsNonNegInteger($userid)
			or return $m->comp("/comp/layout/badarguments",
				text => "The argument <strong>userid</strong> is missing or has a wrong format.");
	}
	else
	{
		# only logged in users can view their subscribers without valid userid parameter.
		$m->comp("/comp/checkloggedin", 1, 1,
			"You must log in to manage your subscriptions.",
		) or return;
		$userid = $session{uid};
	}

	my $mb = $m->comp("/comp/dblogin");

	# load user
	my $ui = UserStuff->new($mb->{DBH});
	my $user = $ui->newFromId($userid)
		or return $m->comp("/comp/error", "There is no user #$userid", 1, 1);
	
	my $is_me = ($userid == $session{uid});

</%perl>

	<& /comp/sidebar-notitle,
		pagetitle => "Subscriptions for editor: " . $user->GetName(),
	&>

	<& /comp/tablebegin, title => 'Editor "'.$user->GetName().'"' &>

		<table class="formstyle">
			<tr class="top">
				<td colspan="2">
					<div style="border-bottom: 1px dotted #ccc; padding: 5px; margin-bottom: 5px; font-weight: bold">
						General information:
					</div></td>		
		
			<tr class="top">
				<td class="label">Contact:</td>
				<td>
					<a href="/show/user/?userid=<% $user->GetId %>">User profile</a> |
					<a href="/user/mod_email.html?uid=<% $user->GetId %>&amp;url=<% uri_escape("/show/user/?userid=".$user->GetId) %>">Send e-mail</a>
				</td>
			</tr>
			<tr class="top">
				<td class="label">Review:</td>
				<td>
					<a href="/mod/search/pre/voted.html?userid=<% $user->GetId %>">Votes</a> |
					<a href="/mod/search/pre/editor.html?userid=<% $user->GetId %>">Edits</a> |
					<a href="/mod/search/pre/editor-open.html?userid=<% $user->GetId %>">Open edits</a> |
					<a href="/mod/search/pre/editor-failed.html?userid=<% $user->GetId %>">Failed edits</a> |
  					<a href="/mod/search/pre/editor-deleted.html?userid=<% $user->GetId %>">Cancelled edits</a> 
				</td>
			</tr>
		</table>
	<& /comp/tableend &>

	<& /comp/subscribersbox, editor => $user,
							 title => 'Editors subscribed to this editor',
							 allow_subscribe => not $is_me,
	&>

<& /comp/footer &>

%# vi: set ts=4 sw=4 ft=mason :
